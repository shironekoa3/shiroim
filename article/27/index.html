<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>MySQL 超详细笔记 | 向日葵</title><meta name="author" content="向日葵"><meta name="copyright" content="向日葵"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="MySQL 基础基础语法(DML)      增删改  -- 新增 一条、多条 数据INSERT [INTO] table_name VALUES (value1 [,value2, …, valuen]);INSERT INTO table_nameVALUES(value1 [,value2, …, valuen]),(value1 [,value2, …, valuen]),……(value">
<meta property="og:type" content="article">
<meta property="og:title" content="MySQL 超详细笔记">
<meta property="og:url" content="https://javac.me/article/27/index.html">
<meta property="og:site_name" content="向日葵">
<meta property="og:description" content="MySQL 基础基础语法(DML)      增删改  -- 新增 一条、多条 数据INSERT [INTO] table_name VALUES (value1 [,value2, …, valuen]);INSERT INTO table_nameVALUES(value1 [,value2, …, valuen]),(value1 [,value2, …, valuen]),……(value">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://javac.me/images/global/gravatar.jpg">
<meta property="article:published_time" content="2022-09-21T01:46:50.000Z">
<meta property="article:modified_time" content="2022-09-21T01:46:50.000Z">
<meta property="article:author" content="向日葵">
<meta property="article:tag" content="shiroy,Blog,向日葵&#39; Blog,shironekoa3,向日葵,个人博客">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://javac.me/images/global/gravatar.jpg"><link rel="shortcut icon" href="/images/global/favicon.ico"><link rel="canonical" href="https://javac.me/article/27/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn1.tianli0.top/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn1.tianli0.top/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn1.tianli0.top/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"top-right"},
  source: {
    justifiedGallery: {
      js: 'https://cdn1.tianli0.top/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn1.tianli0.top/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: false,
  isAnchor: true,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'MySQL 超详细笔记',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-09-21 09:46:50'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/extra.css"><meta name="generator" content="Hexo 5.4.2"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/images/global/gravatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">26</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">29</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">3</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/command/"><i class="fa-fw fas fa-terminal"></i><span> 命令速查</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 文章分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="not-top-img fixed" id="page-header"><nav id="nav"><span id="blog-info"><a href="/" title="向日葵"><span class="site-name">向日葵</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/command/"><i class="fa-fw fas fa-terminal"></i><span> 命令速查</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 文章分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">MySQL 超详细笔记</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-09-21T01:46:50.000Z" title="发表于 2022-09-21 09:46:50">2022-09-21</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-09-21T01:46:50.000Z" title="更新于 2022-09-21 09:46:50">2022-09-21</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%95%99%E7%A8%8B/">教程</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">18.2k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>64分钟</span></span></div></div></div><article class="post-content" id="article-container"><h1 id="MySQL-基础"><a href="#MySQL-基础" class="headerlink" title="MySQL 基础"></a>MySQL 基础</h1><h2 id="基础语法-DML"><a href="#基础语法-DML" class="headerlink" title="基础语法(DML)"></a>基础语法(DML)</h2><details open> 
    <summary>增删改</summary>

<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 新增 一条、多条 数据</span></span><br><span class="line"><span class="keyword">INSERT</span> [<span class="keyword">INTO</span>] table_name <span class="keyword">VALUES</span> (value1 [,value2, …, valuen]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> table_name</span><br><span class="line"><span class="keyword">VALUES</span></span><br><span class="line">(value1 [,value2, …, valuen]),</span><br><span class="line">(value1 [,value2, …, valuen]),</span><br><span class="line">……</span><br><span class="line">(value1 [,value2, …, valuen]);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 将查询结果插入到表中</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> emp2</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> department_id <span class="operator">=</span> <span class="number">90</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 更新数据</span></span><br><span class="line"><span class="keyword">UPDATE</span> table_name</span><br><span class="line"><span class="keyword">SET</span> column1<span class="operator">=</span>value1, column2<span class="operator">=</span>value2, … , <span class="keyword">column</span><span class="operator">=</span>valuen</span><br><span class="line">[<span class="keyword">WHERE</span> <span class="keyword">condition</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除数据</span></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> table_name [<span class="keyword">WHERE</span> <span class="operator">&lt;</span><span class="keyword">condition</span><span class="operator">&gt;</span>];</span><br></pre></td></tr></table></figure>

</details>

<details open> 
    <summary>查询</summary>

<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 基础查询</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> table_name;</span><br><span class="line"><span class="keyword">SELECT</span> column1, column2, column3 <span class="keyword">FROM</span> table_name;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> table_name <span class="keyword">WHERE</span> column1 <span class="operator">=</span> <span class="string">&#x27;value&#x27;</span>;</span><br><span class="line"><span class="keyword">SELECT</span> column1 <span class="keyword">FROM</span> table1 <span class="keyword">WHERE</span> column2 <span class="keyword">BETWEEN</span> <span class="string">&#x27;value1&#x27;</span> <span class="keyword">AND</span> <span class="string">&#x27;value2&#x27;</span>;</span><br><span class="line"><span class="keyword">SELECT</span> column1 <span class="keyword">FROM</span> table1 <span class="keyword">WHERE</span> <span class="keyword">NOT</span> column2 <span class="operator">=</span> <span class="string">&#x27;value&#x27;</span>;</span><br><span class="line"><span class="keyword">SELECT</span> column1 <span class="keyword">FROM</span> table1 <span class="keyword">WHERE</span> column2 <span class="keyword">IN</span> (<span class="string">&#x27;value1&#x27;</span>, <span class="string">&#x27;value2&#x27;</span>, <span class="string">&#x27;value3&#x27;</span>);</span><br><span class="line"><span class="comment">-- LIKE: &#x27;%&#x27; 为任意个数任意字符，&#x27;_&#x27; 为任意一个字符</span></span><br><span class="line"><span class="keyword">SELECT</span> column1 <span class="keyword">FROM</span> table1 <span class="keyword">WHERE</span> column2 <span class="keyword">LIKE</span> <span class="string">&#x27;%value%&#x27;</span>;</span><br><span class="line"><span class="keyword">SELECT</span> column1 <span class="keyword">FROM</span> table1 </span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">EXISTS</span> (<span class="keyword">SELECT</span> column2 <span class="keyword">FROM</span> table2 <span class="keyword">WHERE</span> table1.column1 <span class="operator">=</span> table2.column2);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 排序、分页</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> table_name <span class="keyword">ORDER</span> <span class="keyword">BY</span> column1 <span class="keyword">DESC</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> table_name LIMIT <span class="number">10</span>,<span class="number">5</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> table_name LIMIT <span class="number">5</span> <span class="keyword">OFFSET</span> <span class="number">10</span>; <span class="comment">-- MySQL 8</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- DISTINCT 去重</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> column1 <span class="keyword">FROM</span> table_name;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 函数、分组查询</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">FROM</span> table_name <span class="keyword">WHERE</span> column1 <span class="operator">=</span> <span class="string">&#x27;value&#x27;</span>;</span><br><span class="line"><span class="keyword">SELECT</span> column1, <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">FROM</span> table_name <span class="keyword">GROUP</span> <span class="keyword">BY</span> column1;</span><br><span class="line"><span class="keyword">SELECT</span> column1, <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">FROM</span> table_name <span class="keyword">GROUP</span> <span class="keyword">BY</span> column1 <span class="keyword">HAVING</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="operator">&gt;</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 内连接、外连接(左连接、右连接)</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> table1 <span class="keyword">INNER</span> <span class="keyword">JOIN</span> table2 <span class="keyword">ON</span> table1.column1 <span class="operator">=</span> table2.column2;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> table1 <span class="keyword">LEFT</span> (<span class="keyword">OUTER</span>) <span class="keyword">JOIN</span> table2 <span class="keyword">ON</span> table1.column1 <span class="operator">=</span> table2.column2;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> table1 <span class="keyword">RIGHT</span> (<span class="keyword">OUTER</span>) <span class="keyword">JOIN</span> table2 <span class="keyword">ON</span> table1.column1 <span class="operator">=</span> table2.column2;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- UNION 会去重，UNION ALL 不去重</span></span><br><span class="line"><span class="keyword">SELECT</span> column1 <span class="keyword">FROM</span> table1 <span class="keyword">UNION</span> <span class="keyword">SELECT</span> column2 <span class="keyword">FROM</span> table2;</span><br><span class="line"><span class="keyword">SELECT</span> column1 <span class="keyword">FROM</span> table1 <span class="keyword">UNION</span> <span class="keyword">ALL</span> <span class="keyword">SELECT</span> column2 <span class="keyword">FROM</span> table2;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- CASE WHEN THEN END</span></span><br><span class="line"><span class="keyword">SELECT</span> column1, </span><br><span class="line"><span class="keyword">CASE</span></span><br><span class="line"><span class="keyword">WHEN</span> column2 <span class="operator">=</span> <span class="string">&#x27;value1&#x27;</span> <span class="keyword">THEN</span> <span class="string">&#x27;Result1&#x27;</span></span><br><span class="line"><span class="keyword">WHEN</span> column2 <span class="operator">=</span> <span class="string">&#x27;value2&#x27;</span> <span class="keyword">THEN</span> <span class="string">&#x27;Result2&#x27;</span></span><br><span class="line"><span class="keyword">ELSE</span> <span class="string">&#x27;Other Result&#x27;</span> <span class="keyword">END</span></span><br><span class="line"><span class="keyword">FROM</span> table1;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- MySQL 8 窗口函数，暂时没有使用到。</span></span><br><span class="line"><span class="comment">-- ...</span></span><br></pre></td></tr></table></figure>
</details> 


<h2 id="数据库操作-DDL"><a href="#数据库操作-DDL" class="headerlink" title="数据库操作(DDL)"></a>数据库操作(DDL)</h2><details open> 
    <summary>数据库操作</summary>

<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 创建数据库，以及设置编码</span></span><br><span class="line"><span class="keyword">CREATE</span> DATABASE database_name;</span><br><span class="line"><span class="keyword">CREATE</span> DATABASE database_name <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8mb4 <span class="keyword">COLLATE</span> utf8mb4_unicode_ci;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 如果不存在则创建</span></span><br><span class="line"><span class="keyword">CREATE</span> DATABASE IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> database_name;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 切换数据库</span></span><br><span class="line">USE database_name;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 显示所有数据库、显示当前数据库</span></span><br><span class="line"><span class="keyword">SHOW</span> DATABASES;</span><br><span class="line"><span class="keyword">SELECT</span> DATABASE();</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 显示数据库中的所有表</span></span><br><span class="line"><span class="keyword">SHOW</span> TABLES <span class="keyword">FROM</span> database_name;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 修改数据库编码</span></span><br><span class="line"><span class="keyword">ALTER</span> DATABASE database_name <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8mb4; <span class="comment">-- 比如：gbk、utf8</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除、条件删除数据库</span></span><br><span class="line"><span class="keyword">DROP</span> DATABASE database_name;</span><br><span class="line"><span class="keyword">DROP</span> DATABASE IF <span class="keyword">EXISTS</span> database_name;</span><br></pre></td></tr></table></figure>

</details>




<h2 id="数据表操作"><a href="#数据表操作" class="headerlink" title="数据表操作"></a>数据表操作</h2><details open> 
    <summary>数据表操作</summary>

<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 创建表</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> table_name (</span><br><span class="line">    id <span class="type">INT</span> AUTO_INCREMENT <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;anonymous&#x27;</span>,</span><br><span class="line">    age <span class="type">INT</span> <span class="keyword">CHECK</span>(age <span class="operator">&gt;=</span> <span class="number">0</span>) <span class="keyword">DEFAULT</span> <span class="number">18</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 根据查询语句结果创建表</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> dept80</span><br><span class="line"><span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> employee_id, last_name, salary<span class="operator">*</span><span class="number">12</span> ANNSAL, hire_date</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> department_id <span class="operator">=</span> <span class="number">80</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询表结构</span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> table_name;</span><br><span class="line"><span class="keyword">DESC</span> table_name;</span><br><span class="line"><span class="keyword">DESCRIBE</span> table_name;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 修改表</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_name <span class="keyword">ADD</span> <span class="keyword">COLUMN</span> column_name data_type constraints;</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_name <span class="keyword">DROP</span> <span class="keyword">COLUMN</span> column_name;</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_name CHANGE <span class="keyword">COLUMN</span> old_column_name new_column_name data_type constraints;</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_name MODIFY <span class="keyword">COLUMN</span> column_name new_data_type new_constraints;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 重命名表名</span></span><br><span class="line">RENAME <span class="keyword">TABLE</span> emp <span class="keyword">TO</span> myemp;</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">table</span> dept RENAME [<span class="keyword">TO</span>] detail_dept;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除表</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> table_name;</span><br><span class="line"><span class="comment">-- 用于级联删除，即同时删除该表的所有外键关联表中相关的行。</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> table_name CASCADE;</span><br><span class="line"><span class="comment">-- 用于防止意外删除带有外键的表。</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> table_name RESTRICT;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 清空表</span></span><br><span class="line"><span class="keyword">TRUNCATE</span> <span class="keyword">TABLE</span> detail_dept</span><br></pre></td></tr></table></figure>

</details>


<h2 id="约束-amp-视图"><a href="#约束-amp-视图" class="headerlink" title="约束 &amp; 视图"></a>约束 &amp; 视图</h2><details open> 
    <summary>约束</summary>

<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 主键约束</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> table_name (</span><br><span class="line">  column1 datatype AUTO_INCREMENT <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">  column2 datatype,</span><br><span class="line">  ...</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 外键约束</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> table_name_2 (</span><br><span class="line">  column1 datatype,</span><br><span class="line">  column2 datatype,</span><br><span class="line">  ...</span><br><span class="line">  <span class="keyword">FOREIGN</span> KEY (column1) <span class="keyword">REFERENCES</span> table_name_1 (column1)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 唯一约束</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> table_name (</span><br><span class="line">  column1 datatype,</span><br><span class="line">  column2 datatype,</span><br><span class="line">  ...</span><br><span class="line">  <span class="keyword">UNIQUE</span>(column1, column2, ...)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 检查约束</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> table_name (</span><br><span class="line">  column1 datatype,</span><br><span class="line">  column2 datatype <span class="keyword">CHECK</span> (column2 <span class="operator">&gt;</span> <span class="number">0</span>),</span><br><span class="line">  column3 datatype <span class="keyword">CHECK</span> (column2 <span class="keyword">BETWEEN</span> <span class="number">0</span> <span class="keyword">AND</span> <span class="number">100</span>),</span><br><span class="line">  ...</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 非空约束</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> table_name (</span><br><span class="line">  column1 datatype <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  column2 datatype,</span><br><span class="line">  ...</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 默认约束</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> table_name (</span><br><span class="line">  column1 datatype <span class="keyword">DEFAULT</span> default_value,</span><br><span class="line">  column2 datatype <span class="keyword">DEFAULT</span> default_value,</span><br><span class="line">  ...</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 索引约束</span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX index_name <span class="keyword">ON</span> table_name (column1, column2, ...);</span><br></pre></td></tr></table></figure>

</details>

<details open> 
    <summary>视图</summary>

<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 创建、更新、删除、查看视图</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> view_name <span class="keyword">AS</span> <span class="keyword">SELECT</span> column1, column2, ... <span class="keyword">FROM</span> table_name <span class="keyword">WHERE</span> <span class="keyword">condition</span>;</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">VIEW</span> view_name <span class="keyword">AS</span> <span class="keyword">SELECT</span> column1, column2, ... <span class="keyword">FROM</span> table_name <span class="keyword">WHERE</span> <span class="keyword">condition</span>;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">VIEW</span> view_name;</span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">FULL</span> TABLES <span class="keyword">IN</span> database_name <span class="keyword">WHERE</span> TABLE_TYPE <span class="keyword">LIKE</span> <span class="string">&#x27;VIEW&#x27;</span>;</span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">CREATE</span> <span class="keyword">VIEW</span> view_name;</span><br><span class="line"><span class="keyword">DESC</span>(<span class="keyword">DESCRIBE</span>) view_name;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 刷新视图内容</span></span><br><span class="line">FLUSH TABLES view_name;</span><br></pre></td></tr></table></figure>

</details>


<h2 id="存储过程与函数"><a href="#存储过程与函数" class="headerlink" title="存储过程与函数"></a>存储过程与函数</h2><p>优点：</p>
<ol>
<li>一次编译多次使用。存储过程只在创建时进行编译，之后的使用都不需要重新编译，这就提升了 SQL 的执行效率。</li>
<li>减少开发工作量。将代码 封装 成模块，实际上是编程的核心思想之一，这样可以把复杂的问题拆解成不同的模块，然后模块之间可以 重复使用 ，在减少开发工作量的同时，还能保证代码的结构清晰。</li>
<li>安全性强。我们在设定存储过程的时候可以 设置对用户的使用权限 ，这样就和视图一样具有较强的安全性。</li>
<li>减少网络传输量。因为代码封装到存储过程中，每次使用只需要调用存储过程即可，这样就减少了网络传输量。</li>
<li>良好的封装量。在进行相对复杂的数据库操作时，原本需要使用一条一条的 SQL 语句，可能要连接多次数据库才能完成的操作，现在变成了一次存储过程，只需要 连接一次即可 。</li>
</ol>
<p>缺点：</p>
<ol>
<li>可移植性差。存储过程不能跨数据库移植，比如在 MySQL、Oracle 和 SQL Server 里编写的存储过程，在换成其他数据库时都需要重新编写。</li>
<li>调试困难。只有少数 DBMS 支持存储过程的调试。对于复杂的存储过程来说，开发和维护都不容易。虽然也有一些第三方工具可以对存储过程进行调试，但要收费。</li>
<li>存储过程的版本管理很困难。比如数据表索引发生变化了，可能会导致存储过程失效。我们在开发软件的时候往往需要进行版本管理，但是存储过程本身没有版本控制，版本迭代更新的时候很麻烦。</li>
<li>它不适合高并发的场景。高并发的场景需要减少数据库的压力，有时数据库会采用分库分表的方式，而且对可扩展性要求很高，在这种情况下，存储过程会变得难以维护， 增加数据库的压力 ，显然就不适用了。</li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查看存储过程和函数的创建信息</span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">CREATE</span> &#123;<span class="keyword">PROCEDURE</span> <span class="operator">|</span> <span class="keyword">FUNCTION</span>&#125; 存储过程名或函数名</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看存储过程和函数的状态信息</span></span><br><span class="line"><span class="keyword">SHOW</span> &#123;<span class="keyword">PROCEDURE</span> <span class="operator">|</span> <span class="keyword">FUNCTION</span>&#125; STATUS [<span class="keyword">LIKE</span> <span class="string">&#x27;pattern&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看 information_schema 表里面的信息</span></span><br><span class="line"><span class="keyword">SELECT</span> specific_name,sql_data_access,security_type</span><br><span class="line"><span class="keyword">FROM</span> information_schema.`ROUTINES`</span><br><span class="line"><span class="keyword">WHERE</span> routine_name <span class="operator">=</span> <span class="string">&#x27;CountProc&#x27;</span> <span class="keyword">AND</span> routine_type <span class="operator">=</span> <span class="string">&#x27;PROCEDURE&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 修改</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">PROCEDURE</span> CountProc</span><br><span class="line"><span class="keyword">MODIFIES</span> <span class="keyword">SQL</span> DATA</span><br><span class="line"><span class="keyword">SQL</span> SECURITY INVOKER ;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除</span></span><br><span class="line"><span class="keyword">DROP</span> &#123;<span class="keyword">PROCEDURE</span> <span class="operator">|</span> <span class="keyword">FUNCTION</span>&#125; [IF <span class="keyword">EXISTS</span>] 存储过程或函数的名</span><br></pre></td></tr></table></figure>


<h3 id="PROCEDURE"><a href="#PROCEDURE" class="headerlink" title="PROCEDURE"></a>PROCEDURE</h3><p>关键词解释：</p>
<ul>
<li><code>IN</code>: 入参，如果没有定义参数种类， 默认就是 IN。</li>
<li><code>OUT</code>: 出参，执行完成之后，调用方可以读取这个参数返回的值。</li>
<li><code>INOUT</code>: 当前参数既可以为输入参数，也可以为输出参数。</li>
<li><code>characteristics</code>: 约束条件<ul>
<li><code>LANGUAGE SQL</code>: 说明存储过程执行体是由SQL语句组成的，当前系统支持的语言为SQL。</li>
<li><code>[NOT] DETERMINISTIC</code>: 指明存储过程执行的结果是否确定。<br><code>DETERMINISTIC</code> 表示结果是确定的。每次执行存储过程时，相同的输入会得到相同的输出。<br><code>NOT DETERMINISTIC</code> 默认。表示结果是不确定的，相同的输入可能得到不同的输出。</li>
<li><code>&#123; CONTAINS SQL | NO SQL | READS SQL DATA | MODIFIES SQL DATA &#125;</code>: 指明子程序使用SQL语句的限制。<ul>
<li><code>CONTAINS SQL</code> 默认。表示当前存储过程的子程序包含SQL语句，不包含读写数据的SQL语句；</li>
<li><code>NO SQL</code> 表示当前存储过程的子程序中不包含任何SQL语句；</li>
<li><code>READS SQL DATA</code> 表示当前存储过程的子程序中包含读数据的SQL语句；</li>
<li><code>MODIFIES SQL DATA</code> 表示当前存储过程的子程序中包含写数据的SQL语句。</li>
</ul>
</li>
<li><code>SQL SECURITY &#123; DEFINER | INVOKER &#125;</code>: 执行当前存储过程的权限，即指明哪些用户能够执<br>行当前存储过程。<ul>
<li><code>DEFINER</code> 默认。表示只有当前存储过程的创建者或者定义者才能执行当前存储过程；</li>
<li><code>INVOKER</code> 表示拥有当前存储过程的访问权限的用户能够执行当前存储过程。</li>
</ul>
</li>
<li><code>COMMENT &#39;string&#39;</code>: 注释信息，可以用来描述存储过程。</li>
</ul>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 创建存储过程select_all_data()，查看 emps 表的所有数据</span></span><br><span class="line">DELIMITER $</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> select_all_data()</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> emps;</span><br><span class="line"><span class="keyword">END</span> $</span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建存储过程show_max_salary()，用来查看“emps”表的最高薪资值。</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> show_max_salary()</span><br><span class="line"><span class="keyword">LANGUAGE</span> <span class="keyword">SQL</span></span><br><span class="line"><span class="keyword">NOT</span> <span class="keyword">DETERMINISTIC</span></span><br><span class="line"><span class="keyword">CONTAINS</span> <span class="keyword">SQL</span></span><br><span class="line"><span class="keyword">SQL</span> SECURITY DEFINER</span><br><span class="line">COMMENT <span class="string">&#x27;查看最高薪资&#x27;</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">MAX</span>(salary) <span class="keyword">FROM</span> emps;</span><br><span class="line"><span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建存储过程show_someone_salary2()，查看 emps 表的某个员工的薪资。</span></span><br><span class="line"><span class="comment">-- 并用IN参数 empname 输入员工姓名，用OUT参数 empsalary 输出员工薪资。</span></span><br><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> show_someone_salary2(<span class="keyword">IN</span> empname <span class="type">VARCHAR</span>(<span class="number">20</span>),<span class="keyword">OUT</span> empsalary <span class="keyword">DOUBLE</span>)</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"><span class="keyword">SELECT</span> salary <span class="keyword">INTO</span> empsalary <span class="keyword">FROM</span> emps <span class="keyword">WHERE</span> ename <span class="operator">=</span> empname;</span><br><span class="line"><span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建存储过程，实现累加运算，计算 1+2+…+n 等于多少。</span></span><br><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> `add_num`(<span class="keyword">IN</span> n <span class="type">INT</span>, <span class="keyword">OUT</span> <span class="keyword">result</span> <span class="type">INT</span>)</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">DECLARE</span> i <span class="type">INT</span>;</span><br><span class="line">  <span class="keyword">DECLARE</span> sum <span class="type">INT</span>;</span><br><span class="line">  <span class="keyword">SET</span> i <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">SET</span> sum <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  WHILE i <span class="operator">&lt;=</span> n DO</span><br><span class="line">    <span class="keyword">SET</span> sum <span class="operator">=</span> sum <span class="operator">+</span> i;</span><br><span class="line">    <span class="keyword">SET</span> i <span class="operator">=</span> i <span class="operator">+</span> <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">END</span> WHILE;</span><br><span class="line">  <span class="keyword">SELECT</span> sum <span class="keyword">INTO</span> <span class="keyword">result</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CALL</span> add_num(<span class="number">50</span>, <span class="variable">@res</span>);</span><br><span class="line"><span class="keyword">select</span> <span class="variable">@res</span>;</span><br></pre></td></tr></table></figure>

<h3 id="FUNCTION"><a href="#FUNCTION" class="headerlink" title="FUNCTION"></a>FUNCTION</h3><p>FUNCTION 中所有参数都是 IN 参数。</p>
<p>FUNCTION 函数体中必须存在 <code>RETURN value</code> 语句。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 允许创建函数</span></span><br><span class="line"><span class="comment">-- 不加 global 只是当前窗口有效。</span></span><br><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> log_bin_trust_function_creators<span class="operator">=</span><span class="number">1</span>; </span><br><span class="line"></span><br><span class="line"><span class="comment">-- 基本语法</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> 函数名(参数名 参数类型,...)</span><br><span class="line"><span class="keyword">RETURNS</span> 返回值类型</span><br><span class="line">[characteristics ...]</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">函数体 #函数体中肯定有 <span class="keyword">RETURN</span> 语句</span><br><span class="line"><span class="keyword">END</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 基本示例</span></span><br><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> count_by_id(dept_id <span class="type">INT</span>)</span><br><span class="line"><span class="keyword">RETURNS</span> <span class="type">INT</span></span><br><span class="line"><span class="keyword">LANGUAGE</span> <span class="keyword">SQL</span></span><br><span class="line"><span class="keyword">NOT</span> <span class="keyword">DETERMINISTIC</span></span><br><span class="line"><span class="keyword">READS</span> <span class="keyword">SQL</span> DATA</span><br><span class="line"><span class="keyword">SQL</span> SECURITY DEFINER</span><br><span class="line">COMMENT <span class="string">&#x27;查询部门平均工资&#x27;</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  <span class="keyword">RETURN</span> (<span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> department_id <span class="operator">=</span> dept_id);</span><br><span class="line"><span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SET</span> <span class="variable">@dept</span>_id <span class="operator">=</span> <span class="number">50</span>;</span><br><span class="line"><span class="keyword">SELECT</span> count_by_id(<span class="variable">@dept</span>_id);</span><br></pre></td></tr></table></figure>




<h2 id="数据类型说明"><a href="#数据类型说明" class="headerlink" title="数据类型说明"></a>数据类型说明</h2><table>
<thead>
<tr>
<th align="left">类型</th>
<th align="left">类型举例</th>
</tr>
</thead>
<tbody><tr>
<td align="left">整数类型</td>
<td align="left">TINYINT、SMALLINT、MEDIUMINT、INT(或INTEGER)、BIGINT</td>
</tr>
<tr>
<td align="left">浮点类型</td>
<td align="left">FLOAT、DOUBLE</td>
</tr>
<tr>
<td align="left">定点数类型</td>
<td align="left">DECIMAL</td>
</tr>
<tr>
<td align="left">位类型</td>
<td align="left">BIT</td>
</tr>
<tr>
<td align="left">日期时间类型</td>
<td align="left">YEAR、TIME、DATE、DATETIME、TIMESTAMP</td>
</tr>
<tr>
<td align="left">文本字符串类型</td>
<td align="left">CHAR、VARCHAR、TINYTEXT、TEXT、MEDIUMTEXT、LONGTEXT</td>
</tr>
<tr>
<td align="left">枚举类型</td>
<td align="left">ENUM</td>
</tr>
<tr>
<td align="left">集合类型</td>
<td align="left">SET</td>
</tr>
<tr>
<td align="left">二进制字符串类型</td>
<td align="left">BINARY、VARBINARY、TINYBLOB、BLOB、MEDIUMBLOB、LONGBLOB</td>
</tr>
<tr>
<td align="left">JSON类型</td>
<td align="left">JSON对象、JSON数组</td>
</tr>
<tr>
<td align="left">空间数据类型</td>
<td align="left">单值类型：GEOMETRY、POINT、LINESTRING、POLYGON；</td>
</tr>
<tr>
<td align="left">空间数据类型</td>
<td align="left">集合类型：MULTIPOINT、MULTILINESTRING、MULTIPOLYGON、GEOMETRYCOLLECTION</td>
</tr>
</tbody></table>
<p><strong>整数类型说明：</strong></p>
<p>占用字节：TINYINT(1)、SMALLINT(2)、MEDIUMINT(3)、INT/INTEGER(4)、BIGINT(8)<br><code>UNSIGNED</code>: 无符号整数。<br><code>ZEROFILL</code>: 0 填充。必须和 <code>UNSIGNED</code> 一起使用(或者 MySQL 自动添加)，并不会影响实际存储字节。如 <code>UNSIGNED INT(3)</code> 类型存入数据 1，此时仍然占 4 个字节，但是数据形式会变成 <code>001</code>。当然，如果存入了 4 位数或者更大，则此属性可以无视。</p>
<p><strong>浮点类型说明：</strong></p>
<p>占用字节：FLOAT(4)、DOUBLE(8)<br><code>REAL</code>: 额外的浮点类型，等同于 FLOAT 或者 DOUBLE，取决于全局变量 <code>sql_mode</code> 的值。<br>精度误差问题：由于浮点的存储形式特殊，任何编程语言的浮点类型都有精度问题，因此要避免判断浮点类型数据是否相等。如果对精度要求比较高，可以用 <code>DECIMAL</code> 定点数类型。<br>无符号：将浮点类型设置为无符号之后，取值范围的负数部分会删除，但是正数部分仍然是原来的大小，相当于缩减一半取值范围。这是由于浮点类型的存储形式导致的。</p>
<p><strong>定点数类型说明：</strong></p>
<p>定义方式：DECIMAL(M,D)，M 为长度，D 为标度。M[0, 65], D[0, 30], D &lt; M。<br>默认：DECIMAL(10, 0)。<br>示例：DECIMAL(5, 2) 取值范围为 <code>-999.99~999.99</code>。<br>占用字节：M + 2。<br>存储形式：DECIMAL 在 MySQL 内部是以 <code>字符串</code> 的形式进行存储的，因此它是一定精准的。<br>与浮点数对比：浮点数占用空间小，数值不精准。定点数占用空间大，数值精准。</p>
<p><strong>位类型说明：</strong></p>
<p>定义方式：BIT(M)，M 为长度。M[0, 64]。<br>默认：BIT(1)。<br>占用字节：(M + 7) / 8。</p>
<p><strong>日期时间类型说明：</strong></p>
<table>
<thead>
<tr>
<th align="left">类型</th>
<th align="left">名称</th>
<th align="left">字节</th>
<th align="left">日期格式</th>
<th align="left">最小值</th>
<th align="left">最大值</th>
</tr>
</thead>
<tbody><tr>
<td align="left">YEAR</td>
<td align="left">年</td>
<td align="left">1</td>
<td align="left">YYYY 或 YY</td>
<td align="left">1901</td>
<td align="left">2155</td>
</tr>
<tr>
<td align="left">TIME</td>
<td align="left">时间</td>
<td align="left">3</td>
<td align="left">HH:MM:SS</td>
<td align="left">-838:59:59</td>
<td align="left">838:59:59</td>
</tr>
<tr>
<td align="left">DATE</td>
<td align="left">日期</td>
<td align="left">3</td>
<td align="left">YYYY-MM-DD</td>
<td align="left">1000-01-01</td>
<td align="left">9999-12-03</td>
</tr>
<tr>
<td align="left">DATETIME</td>
<td align="left">日期时间</td>
<td align="left">8</td>
<td align="left">YYYY-MM-DD HH:MM:SS</td>
<td align="left">1000-01-01 00:00:00</td>
<td align="left">9999-12-31 23:59:59</td>
</tr>
<tr>
<td align="left">TIMESTAMP</td>
<td align="left">日期时间</td>
<td align="left">4</td>
<td align="left">YYYY-MM-DD HH:MM:SS</td>
<td align="left">1970-01-01 00:00:00 UTC</td>
<td align="left">2038-01-19 03:14:07UTC</td>
</tr>
</tbody></table>
<p>TIME: 在 MySQL 中，TIME 不仅可以表示时间，还可以表示一段时间间隔，因此取值范围大于 24 小时。<br>YEAR：YEAR 只占 1 个字节，但是 YEAR 的值比较复杂：</p>
<ul>
<li>以 4 位字符串或数字格式表示 YEAR 类型时，格式为 YYYY，取值范围为 [1901, 2155]。</li>
<li>以 2 位字符串格式表示 YEAR 类型时，取值范围为 [00, 99];<ul>
<li>当取值为 01 ~ 69 时，表示 2001 到 2069。</li>
<li>当取值为 70 ~ 99 时，表示 1970 到 1999。</li>
<li>当取值为整数 0 时，表示 0000 年。</li>
<li>当取值为字符串的 ‘0’ 时，表示 2000 年。<br>从 MySQL 5.5.27 开始，2 位格式的 YEAR 已经不推荐使用了。<br>TIMESTAMP：底层存储的是距离 1970-01-01 00:00:00 的毫秒值，因此，涉及到日期比较大小或计算时，TIMESTAMP 效率会更高一些。并且在取值时 TIMESTAMP 会根据时区来计算实际日期。在实际开发中，保存注册时间、发布时间等数据时，可以使用 TIMESTAMP 存储便于计算。其他情况一般使用 DATETIME。</li>
</ul>
</li>
</ul>
<p><strong>文本类型说明：</strong></p>
<table>
<thead>
<tr>
<th align="left">类型</th>
<th align="left">值长度</th>
<th align="left">长度范围</th>
<th align="left">占用空间(字节)</th>
</tr>
</thead>
<tbody><tr>
<td align="left">CHAR(M)</td>
<td align="left">M</td>
<td align="left">[0, 255]</td>
<td align="left">M</td>
</tr>
<tr>
<td align="left">VARCHAR(M)</td>
<td align="left">M</td>
<td align="left">[0, 65535]</td>
<td align="left">M + 1</td>
</tr>
<tr>
<td align="left">TINYTEXT</td>
<td align="left">L</td>
<td align="left">[0, 255]</td>
<td align="left">L + 2</td>
</tr>
<tr>
<td align="left">TEXT</td>
<td align="left">L</td>
<td align="left">[0, 65535]</td>
<td align="left">L + 2</td>
</tr>
<tr>
<td align="left">MEDIUMTEXT</td>
<td align="left">L</td>
<td align="left">[0, 16777215]</td>
<td align="left">L + 3</td>
</tr>
<tr>
<td align="left">LONGTEXT</td>
<td align="left">L</td>
<td align="left">[0, 4294967295]</td>
<td align="left">L + 4</td>
</tr>
<tr>
<td align="left">ENUM</td>
<td align="left">L</td>
<td align="left">[1, 65535]</td>
<td align="left">1 或者 2</td>
</tr>
<tr>
<td align="left">SET</td>
<td align="left">L</td>
<td align="left">[0, 64]</td>
<td align="left">1,2,3,4 或者 8</td>
</tr>
</tbody></table>
<p><code>CHAR</code>：固定长度字符串，默认为 1 个字符。若数据实际长度未达到指定长度，则会在数据右侧添加空格补齐。MySQL 检索时会去除尾部空格。空间消耗高，查询效率高。<code>MyISAM 引擎建议使用</code>。<br><code>VARCHAR</code>：UTF8 汉字占 3 个字节，在 MySQL 4.0 及之前版本，20 长度只能存 6 个汉字；在 MySQL 5.0 及以上版本，20 长度即为 20 个汉字。MySQL 检索时会保留尾部的空格。空间消耗低，查询效率低。<code>InnoDB 引擎建议使用</code>。<br><code>TEXT</code>: 长度不固定，无法做主键。搜索速度稍慢，无法设定默认值。TEXT 和 BLOB 类型的数据删除之后容易导致空洞，让文件碎片变多，因此实际开发中频繁使用的表不建议包含 TEXT 字段，建议单独分出去，单独用一个表。<br><code>ENUM</code>：当包含 1 ~ 255 个成员时占用 1 个字节；当包含 256 ~ 65535 个成员时占用 2 个字节。<br><code>SET</code>：包含 1 ~ 8 个成员时占用 1 个字节；9 ~ 16 个成员占用 2 个字节；17 ~ 24 个成员占用 3 个字节；25 ~ 32 个成员占用 4 个字节；33 ~ 64 个成员占用 8 个字节。</p>
<h1 id="MySQL-安装"><a href="#MySQL-安装" class="headerlink" title="MySQL 安装"></a>MySQL 安装</h1><h2 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h2><p><strong>1.下载</strong></p>
<blockquote>
<p>MySQL 官网下载链接：<a target="_blank" rel="noopener" href="https://dev.mysql.com/downloads/mysql/">https://dev.mysql.com/downloads/mysql/</a></p>
</blockquote>
<p>进入官网下载压缩包，并解压到一个目录。</p>
<p><img src="/images/posts/mysql8install/1.jpg" alt="MySQL"></p>
<p><strong>2.配置</strong></p>
<p>首先需要在 MySQL 目录中创建一个 <code>my.ini</code> 文件作为配置文件。</p>
<p><img src="/images/posts/mysql8install/2.jpg" alt="MySQL"></p>
<p>然后编写配置信息，修改 <code>basedir</code> 和 <code>datadir</code> 为实际安装目录：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line">port=3306</span><br><span class="line">basedir=D:/mysql-8.0.28-winx64</span><br><span class="line">datadir=D:/mysql-8.0.28-winx64/data</span><br><span class="line">max_connections=200</span><br><span class="line">max_connect_errors=10</span><br><span class="line">character-set-server=utf8mb4</span><br><span class="line">default-storage-engine=INNODB</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">在 MySQL 8 版本中默认使用 caching_sha2_password 认证方式，在旧版客户端中可能无法登陆，需要改成 mysql_native_password 认证方式。</span></span><br><span class="line">default_authentication_plugin=mysql_native_password</span><br><span class="line"></span><br><span class="line">[mysql]</span><br><span class="line">port=3306</span><br><span class="line"></span><br><span class="line">[client]</span><br><span class="line">default-character-set=utf8mb4</span><br></pre></td></tr></table></figure>

<p><code>mysqld</code> 表示服务器配置，<code>mysql</code> 和 <code>client</code> 均表示客户端配置，各个键名称及其含义如下：</p>
<table>
<thead>
<tr>
<th align="left">名称</th>
<th align="left">含义</th>
</tr>
</thead>
<tbody><tr>
<td align="left">port</td>
<td align="left">表示 MySQL 服务器的端口号</td>
</tr>
<tr>
<td align="left">basedir</td>
<td align="left">表示 MySQL 的安装路径</td>
</tr>
<tr>
<td align="left">datadir</td>
<td align="left">表示 MySQL 数据文件的存储位置，也是数据表的存放位置</td>
</tr>
<tr>
<td align="left">default-character-set</td>
<td align="left">表示服务器端默认的字符集</td>
</tr>
<tr>
<td align="left">default-storage-engine</td>
<td align="left">创建数据表时，默认使用的存储引擎</td>
</tr>
<tr>
<td align="left">sql-mode</td>
<td align="left">表示 SQL 模式的参数，通过这个参数可以设置检验 SQL 语句的严格程度</td>
</tr>
<tr>
<td align="left">max_connections</td>
<td align="left">表示允许同时访问 MySQL 服务器的最大连接数。其中一个连接是保留的，留给管理员专用的</td>
</tr>
<tr>
<td align="left">query_cache_size</td>
<td align="left">表示查询时的缓存大小，缓存中可以存储以前通过 SELECT 语句查询过的信息，再次查询时就可以直接从缓存中拿出信息，可以改善查询效率</td>
</tr>
<tr>
<td align="left">table_open_cache</td>
<td align="left">表示所有进程打开表的总数</td>
</tr>
<tr>
<td align="left">tmp_table_size</td>
<td align="left">表示内存中每个临时表允许的最大大小</td>
</tr>
<tr>
<td align="left">thread_cache_size</td>
<td align="left">表示缓存的最大线程数</td>
</tr>
<tr>
<td align="left">myisam_max_sort_file_size</td>
<td align="left">表示 MySQL 重建索引时所允许的最大临时文件的大小</td>
</tr>
<tr>
<td align="left">myisam_sort_buffer_size</td>
<td align="left">表示重建索引时的缓存大小</td>
</tr>
<tr>
<td align="left">key_buffer_size</td>
<td align="left">表示关键词的缓存大小</td>
</tr>
<tr>
<td align="left">read_buffer_size</td>
<td align="left">表示 MyISAM 表全表扫描的缓存大小</td>
</tr>
<tr>
<td align="left">read_rnd_buffer_size</td>
<td align="left">表示将排序好的数据存入该缓存中</td>
</tr>
<tr>
<td align="left">sort_buffer_size</td>
<td align="left">表示用于排序的缓存大小</td>
</tr>
<tr>
<td align="left">default_authentication_plugin</td>
<td align="left">表示 MySQL 默认认证方式</td>
</tr>
</tbody></table>
<p><strong>3.初始化</strong></p>
<p>以<code>管理员身份</code>运行 CMD，切换到 MySQL 目录下的 bin 目录：</p>
<p>执行 <code>mysqld --initialize --console</code> 初始化数据库（预计 30 秒）。初始化成功后，会生成随机初始密码，可以保存下来，安装成功后登陆修改密码。</p>
<p>执行 <code>mysqld --install</code> 来安装 MySQL 服务。</p>
<p>执行 <code>net start mysql</code> 来启动 MySQL 服务。</p>
<p><img src="/images/posts/mysql8install/3.jpg" alt="MySQL"></p>
<p>至此，MySQL 已经安装成功！</p>
<p><strong>4.修改密码</strong></p>
<p>在第三步执行初始化数据库命令时，会生成默认密码。可以由此密码登陆修改默认密码。</p>
<p>执行 <code>mysql -uroot -p&quot;w3Si.I&amp;t+8A4&quot;</code> 来登陆 MySQL（鼠标右键可以粘贴密码）。</p>
<p>执行 SQL 语句修改密码为 <code>root</code>：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ALTER USER &#x27;root&#x27;@&#x27;localhost&#x27; IDENTIFIED BY &#x27;root&#x27;;</span><br></pre></td></tr></table></figure>

<p><img src="/images/posts/mysql8install/4.jpg" alt="MySQL"></p>
<p>密码修改完成！</p>
<h2 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h2><p>以 <code>Centos 7</code> 为例：</p>
<p>第一步：安装 MySQL 的 Yum 存储库，以便能从中安装软件包。<br>Yum 的存储库地址可以在 MySQL 官网查看：<a target="_blank" rel="noopener" href="https://dev.mysql.com/downloads/repo/yum/">https://dev.mysql.com/downloads/repo/yum/</a></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum install https://dev.mysql.com/get/mysql80-community-release-el7-7.noarch.rpm</span><br></pre></td></tr></table></figure>

<p>第二步：安装 MySQL 服务器和客户端软件包：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum install mysql-community-server mysql-community-client</span><br></pre></td></tr></table></figure>

<blockquote>
<p>安装之后 MySQL 的配置文件为 <code>/etc/my.cnf</code></p>
</blockquote>
<p>第三步：启动 MySQL 服务，并设置自启：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">systemctl start mysqld</span><br><span class="line">systemctl enable mysqld</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看进程</span></span><br><span class="line">ps -ef | grep -i mysql</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看服务是否自启</span></span><br><span class="line">systemctl list-unit-files|grep mysqld</span><br></pre></td></tr></table></figure>

<p>第四部：初始化 MySQL 配置</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mysqld --initialize --user=mysql</span><br></pre></td></tr></table></figure>

<p>说明：<code>--initialize</code> 选项默认以安全模式来初始化，会为 root 用户生成一个密码，并将该密码标记为过期，登陆后需要重新修改一次密码。生成的随机密码在日志中记录：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cat /var/log/mysqld.log</span><br></pre></td></tr></table></figure>

<p>第五步：登陆 MySQL，修改密码：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">登陆：</span></span><br><span class="line">mysql -uroot -p</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">如果密码有特殊字符，在传参的时候需要加入引号</span></span><br><span class="line">mysql -uroot -p&quot;(kK;kJKkb0sP&quot;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># 修改密码(MYSQL 命令)</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">user</span> <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> identified <span class="keyword">by</span> <span class="string">&#x27;root123&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h1 id="MySQL-远程连接"><a href="#MySQL-远程连接" class="headerlink" title="MySQL 远程连接"></a>MySQL 远程连接</h1><p>要远程连接 MySQL，需要保证客户端与服务端能正常进行连接。</p>
<p>客户端一般不需要做处理，服务端为了安全保证，可能会开启防火墙对端口进行限制。</p>
<p>因此，为了保证正常连接，有如下两种办法：</p>
<ul>
<li>执行 <code>systemctl stop firewalld</code> 命令关闭服务器防火墙。</li>
<li>开启防火墙，配置 3306 端口允许访问（查看下方命令）。</li>
</ul>
<p>当然，如果用的是 阿里云/腾讯云/华为云 之类的 ECS 搭建的 MySQL，则还需要在 ECS 安全组规则里面允许 3306 端口访问。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看/开启/关闭 防火墙状态</span></span><br><span class="line">systemctl status/start/stop firewalld</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看防火墙开机自启状态</span></span><br><span class="line">systemctl list-unit-files|grep firewalld</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">设置防火墙 开启/关闭 开机自启</span></span><br><span class="line">systemctl enable/disable firewalld</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看防火墙开放端口</span></span><br><span class="line">firewall-cmd --list-all</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">添加防火墙开放端口</span></span><br><span class="line">firewall-cmd --add-service=http --permanent</span><br><span class="line">firewall-cmd --add-port=3306/tcp --permanent</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">重启防火墙</span></span><br><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure>

<p>通过以上操作，可以确保客户端和服务器是能够正常连接的。</p>
<p>但是 <code>此时仍然无法在电脑上远程连接服务器</code> 的 MySQL，因为 MySQL 的 root 用户默认只允许 localhost 连接。我们可以将其修改为指定 IP 连接或者任意 IP 连接。</p>
<p>在 mysql 数据库下的 user 表中记录 root 用户的 host：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">use mysql;</span><br><span class="line"># 登陆 MySQL，执行下面的查询语句：</span><br><span class="line"><span class="keyword">select</span> host,<span class="keyword">user</span> <span class="keyword">from</span> <span class="keyword">user</span>;</span><br><span class="line"></span><br><span class="line"># 此时会列出 root 用户的访问 host 只有 localhost</span><br><span class="line"># 可以修改为指定 IP 连接：</span><br><span class="line"><span class="keyword">update</span> <span class="keyword">user</span> <span class="keyword">set</span> host <span class="operator">=</span> <span class="string">&#x27;192.168.1.%&#x27;</span> <span class="keyword">where</span> <span class="keyword">user</span> <span class="operator">=</span> <span class="string">&#x27;root&#x27;</span>;</span><br><span class="line"># 或者修改为任意 IP 连接：</span><br><span class="line"><span class="keyword">update</span> <span class="keyword">user</span> <span class="keyword">set</span> host <span class="operator">=</span> <span class="string">&#x27;%&#x27;</span> <span class="keyword">where</span> <span class="keyword">user</span> <span class="operator">=</span> <span class="string">&#x27;root&#x27;</span>;</span><br><span class="line"></span><br><span class="line"># 在修改之后，一定要执行下面的刷新权限命令，才能生效。</span><br><span class="line">flush privileges;</span><br></pre></td></tr></table></figure>

<p>如果是 MySQL 5.7 版本，在执行上述操作之后即可成功连接。</p>
<p>但是 MySQL 8.0 修改了加密插件，连接时可能会出现 <code>Plugin caching_sha2_passowrd could not be loaded: xxxx</code> 这样的问题。</p>
<p>这时，就需要修改加密插件为 <code>mysql_native_password</code>。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># 修改加密插件</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">user</span> <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;%&#x27;</span> identified <span class="keyword">with</span> mysql_native_password <span class="keyword">by</span> <span class="string">&#x27;root123&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>或者修改配置文件之后重启 MySQL 服务：</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">[mysqld]</span></span><br><span class="line"><span class="attr">port</span>=<span class="string">3306</span></span><br><span class="line"><span class="attr">...</span></span><br><span class="line"><span class="comment"># 添加加密插件配置</span></span><br><span class="line"><span class="attr">default_authentication_plugin</span>=<span class="string">mysql_native_password</span></span><br></pre></td></tr></table></figure>

<h1 id="MySQL-密码强弱评估"><a href="#MySQL-密码强弱评估" class="headerlink" title="MySQL 密码强弱评估"></a>MySQL 密码强弱评估</h1><p>若在修改密码时，提示了如下错误：</p>
<pre><code>ERROR 1819 (HY000): Your password does not satisfy the current policy requirements
</code></pre>
<p>这是因为在 MySQL 5.7 版本之后(不含 5.7)，MySQL 加入了全新的密码安全机制，设置密码太简单会报错。</p>
<p>若要解决此问题，可以直接跳过 <code>开启插件</code> 步骤，对插件进行修改或者直接卸载即可。</p>
<h2 id="开启插件"><a href="#开启插件" class="headerlink" title="开启插件"></a>开启插件</h2><p>若要手动开启，可以使用下面两种方式：</p>
<p>开启方式一：在配置文件中加入如下两个配置，然后重启 MySQL 服务。</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">[mysqld]</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 对于 Unix 和 Unix-like 系统，值为 validate_password.so</span></span><br><span class="line"><span class="comment"># 对于 Windows，值为 validate_password.dll</span></span><br><span class="line"><span class="attr">plugin-load-add</span>=<span class="string">validate_password.so</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># ON/OFF/FORCE/FORCE_PLUS_PERMANENT (开/关/强制/永久强制)</span></span><br><span class="line"><span class="attr">validate-password</span>=<span class="string">FORCE_PLUS_PERMANENT</span></span><br></pre></td></tr></table></figure>

<p>开启方式二：使用如下 MySQL 语句安装插件。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- linux</span></span><br><span class="line">INSTALL PLUGIN validate_password SONAME <span class="string">&#x27;validate_password.so&#x27;</span></span><br><span class="line"><span class="comment">-- windows</span></span><br><span class="line">INSTALL PLUGIN validate_password SONAME <span class="string">&#x27;validate_password.dll&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="修改检测方式"><a href="#修改检测方式" class="headerlink" title="修改检测方式"></a>修改检测方式</h2><p>查看安全验证的配置：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;validate_password%&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>关于 <code>validate_password</code> 组件对应的系统变量说明：</p>
<table>
<thead>
<tr>
<th align="left">选项</th>
<th align="left">默认值</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">validate_password_check_user_name</td>
<td align="left">ON</td>
<td align="left">用户名和密码能否一致</td>
</tr>
<tr>
<td align="left">validate_password_dictionary_file</td>
<td align="left"></td>
<td align="left">用于检查密码的字典文件路径，默认为空</td>
</tr>
<tr>
<td align="left">validate_password_length</td>
<td align="left">8</td>
<td align="left">密码最小长度</td>
</tr>
<tr>
<td align="left">validate_password_mixed_case_count</td>
<td align="left">1</td>
<td align="left">如果密码策略是 <code>中</code> 或 <code>强</code>，要求密码具有的小写和大写字符的最小数量。</td>
</tr>
<tr>
<td align="left">validate_password_number_count</td>
<td align="left">1</td>
<td align="left">包含的数字个数</td>
</tr>
<tr>
<td align="left">validate_password_policy</td>
<td align="left">MEDIUM</td>
<td align="left">密码强弱检验等级，取值为 0/1/2 或者 LOW/MEDIUM/STRONG。0 只检测强度；1 检测长度、数字、大小写和特殊字符；2 检测长度、数字、大小写、特殊字符、字典文件</td>
</tr>
<tr>
<td align="left">validate_password_special_char_count</td>
<td align="left">1</td>
<td align="left">特殊字符个数</td>
</tr>
</tbody></table>
<p>可以用 SQL 语句来修改插件的检测方式：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> validate_password_policy<span class="operator">=</span>LOW</span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> validate_password_length<span class="operator">=</span><span class="number">1</span></span><br></pre></td></tr></table></figure>

<h2 id="卸载插件"><a href="#卸载插件" class="headerlink" title="卸载插件"></a>卸载插件</h2><p>如果不想使用此插件，可以直接使用 SQL 语句进行卸载：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 卸载插件：</span></span><br><span class="line">UNINSTALL PLUGIN validate_password;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 卸载组件：</span></span><br><span class="line">UNINSTALL COMPONENT <span class="string">&#x27;file://component_validate_password&#x27;</span>;</span><br></pre></td></tr></table></figure>


<h1 id="MySQL-目录结构"><a href="#MySQL-目录结构" class="headerlink" title="MySQL 目录结构"></a>MySQL 目录结构</h1><p>在 Linux 系统中，可以使用 <code>find / -name mysql</code> 命令来查看相关目录。</p>
<p>其中有几个重要的目录：</p>
<ul>
<li><code>/etc/my.cnf</code>：MySQL 的配置文件。</li>
<li><code>/var/lib/mysql</code>：该目录存放数据库文件，类似 Windows 版本的 Data 目录。</li>
<li><code>/usr/bin/mysql*</code>：这里存放着 MySQL 的指令。</li>
</ul>
<p>同时，也可以用以下 SQL 语句来查看当前数据库存放目录：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;datadir&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>在数据库存放目录中，每个数据库都对应一个目录，在目录里面保存着数据库的信息，不同存储引擎和数据库版本里面的文件也不相同：</p>
<p>在 MySQL 5.6.6 版本及之后，每个数据库的目录里面会有如下文件：</p>
<p><code>/var/lib/mysql/数据库名/</code> 目录下的文件：</p>
<ul>
<li><code>db.opt</code>：存放数据库字符集、比较规则等信息。</li>
<li><code>xxx.frm</code>：存放表的结构</li>
<li><code>xxx.ibd</code>：存放表的数据，独立表空间</li>
</ul>
<p>在 MySQL 5.6.6 版本之前，并没有独立表空间文件(<code>xxx.ibd</code>)。所有表中的数据都存放在 <code>/var/lib/mysql/ibdata1</code> 文件中，该文件也被称为系统表空间，默认 12 MB 大小，不够用时自动增加大小，也可以修改配置文件来修改初始大小：</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">[server]</span></span><br><span class="line"><span class="attr">innodb_data_file_path</span>=<span class="string">data1:512M;data2:512M;autoextend</span></span><br></pre></td></tr></table></figure>

<p>在 MySQL 5.6.6 版本及之后也可以通过配置来将数据保存在系统表空间中：</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">[server]</span></span><br><span class="line"><span class="attr">innodb_file_per_table</span>=<span class="string">0    # 0: 系统表空间 1: 独立表空间</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查询该配置信息的 SQL 语句</span></span><br><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;innodb_file_per_table&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>在 MySQL 8.0 之后，数据库目录中不再存放 <code>db.opt</code> 文件和表的 <code>xxx.frm</code> 文件，他们全部合并到了 <code>xxx.ibd</code> 文件中。</p>
<p>我们可以通过使用 <code>ibd2sdi</code> 工具来解析 <code>ibd</code> 文件里的信息：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ibd2sdi user.ibd --dump-file=user.txt</span><br></pre></td></tr></table></figure>

<p>而在 MyISAM 存储引擎中，每个表都对应 3 个文件：<code>user.frm</code>, <code>user.MYD</code>, <code>user.MYI</code>。</p>
<p>在 MySQL 8.0 中，<code>user.frm</code> 文件变成了 <code>user.xxx.sdi</code>，只修改了后缀名而已。</p>
<p>MYI 文件记录 index 索引信息，MYD 文件记录数据信息，是分开存放的。而 Innodb 中是合并成了一个 ibd 文件。</p>
<h1 id="用户与权限管理"><a href="#用户与权限管理" class="headerlink" title="用户与权限管理"></a>用户与权限管理</h1><h2 id="用户管理"><a href="#用户管理" class="headerlink" title="用户管理"></a>用户管理</h2><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查询用户和HOST:</span></span><br><span class="line">USE mysql;</span><br><span class="line"><span class="keyword">SELECT</span> HOST,<span class="keyword">USER</span> <span class="keyword">FROM</span> <span class="keyword">USER</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建一个用户：不写 host 默认是 &#x27;%&#x27;</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">&#x27;zhangsan&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;abc123&#x27;</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">&#x27;zhangsan&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;abc123&#x27;</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">&#x27;zhangsan&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;abc123&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 修改用户名：实际上是修改 user 表中的数据</span></span><br><span class="line"><span class="keyword">UPDATE</span> <span class="keyword">USER</span> <span class="keyword">SET</span> <span class="keyword">USER</span><span class="operator">=</span><span class="string">&#x27;lisi&#x27;</span> <span class="keyword">WHERE</span> <span class="keyword">USER</span><span class="operator">=</span><span class="string">&#x27;zhangsan&#x27;</span> <span class="keyword">AND</span> HOST<span class="operator">=</span><span class="string">&#x27;%&#x27;</span>;</span><br><span class="line">FLUSH PRIVILEGES;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除用户</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">USER</span> <span class="string">&#x27;zhangsan&#x27;</span>;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">USER</span> <span class="string">&#x27;zhangsan&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 修改密码：user() 函数可以获取当前登陆用户</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">USER</span> <span class="string">&#x27;zhangsan&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;newpassword.A1&#x27;</span>;</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">USER</span> <span class="keyword">USER</span>() IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;newpassword.A1&#x27;</span>;</span><br><span class="line"><span class="keyword">SET</span> PASSWORD<span class="operator">=</span><span class="string">&#x27;newpassword.A1&#x27;</span>;</span><br><span class="line"><span class="keyword">SET</span> PASSWORD <span class="keyword">FOR</span> <span class="string">&#x27;zhangsan&#x27;</span>@<span class="string">&#x27;%&#x27;</span><span class="operator">=</span><span class="string">&#x27;newpassword.A1&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h2 id="用户密码过期策略"><a href="#用户密码过期策略" class="headerlink" title="用户密码过期策略"></a>用户密码过期策略</h2><p>可以使用 SQL 语句或修改配置文件的方式来设置全局密码过期时间，达到时间之后用户必须修改密码才能继续使用。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 建立全局策略，设置密码每隔 180 天过期。</span></span><br><span class="line"><span class="keyword">SET</span> PERSIST default_password_lifetime<span class="operator">=</span><span class="number">180</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">[mysqld]</span></span><br><span class="line"><span class="attr">default_password_lifetime</span>=<span class="string">180    # 建立全局策略，设置密码每隔 180 天过期。</span></span><br></pre></td></tr></table></figure>

<p>同时，也可以指定每个用户的过期时间：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 创建用户时指定或创建后修改：</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">&#x27;zhangsan&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;abc123&#x27;</span> PASSWORD EXPIRE <span class="type">INTERVAL</span> <span class="number">90</span> <span class="keyword">DAY</span>;</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">USER</span> <span class="string">&#x27;zhangsan&#x27;</span>@<span class="string">&#x27;%&#x27;</span> PASSWORD EXPIRE <span class="type">INTERVAL</span> <span class="number">90</span> <span class="keyword">DAY</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 设置永不过期：</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">USER</span> <span class="string">&#x27;zhangsan&#x27;</span>@<span class="string">&#x27;%&#x27;</span> PASSWORD EXPIRE NEVER;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 设置使用全局策略：</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">USER</span> <span class="string">&#x27;zhangsan&#x27;</span>@<span class="string">&#x27;%&#x27;</span> PASSWORD EXPIRE <span class="keyword">DEFAULT</span>;</span><br></pre></td></tr></table></figure>

<h2 id="用户密码重用策略"><a href="#用户密码重用策略" class="headerlink" title="用户密码重用策略"></a>用户密码重用策略</h2><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 设置不能选择最近使用过的 6 个密码</span></span><br><span class="line"><span class="keyword">SET</span> PERSIST password_history<span class="operator">=</span><span class="number">6</span>;</span><br><span class="line"><span class="comment">-- 设置不能选择最近 90 天内使用过的密码</span></span><br><span class="line"><span class="keyword">SET</span> PERSIST password_reuse_interval<span class="operator">=</span><span class="number">90</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">[mysqld]</span></span><br><span class="line"><span class="attr">password_history</span>=<span class="string">6</span></span><br><span class="line"><span class="attr">password_reuse_interval</span>=<span class="string">90</span></span><br></pre></td></tr></table></figure>

<p>同时，也可以对某个用户单独设置：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">&#x27;zhangsan&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;abc123&#x27;</span> PASSWORD HISTORY <span class="number">5</span>;</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">USER</span> <span class="string">&#x27;zhangsan&#x27;</span>@<span class="string">&#x27;%&#x27;</span> PASSWORD REUSE <span class="type">INTERVAL</span> <span class="number">90</span> <span class="keyword">DAY</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 同时使用</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">USER</span> <span class="string">&#x27;zhangsan&#x27;</span>@<span class="string">&#x27;%&#x27;</span></span><br><span class="line">PASSWORD HISTORY <span class="number">5</span></span><br><span class="line">PASSWORD REUSE <span class="type">INTERVAL</span> <span class="number">90</span> <span class="keyword">DAY</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 设置使用全局策略</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">USER</span> <span class="string">&#x27;zhangsan&#x27;</span>@<span class="string">&#x27;%&#x27;</span></span><br><span class="line">PASSWORD HISTORY <span class="keyword">DEFAULT</span></span><br><span class="line">PASSWORD REUSE <span class="type">INTERVAL</span> <span class="keyword">DEFAULT</span>;</span><br></pre></td></tr></table></figure>

<h2 id="权限管理"><a href="#权限管理" class="headerlink" title="权限管理"></a>权限管理</h2><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 给 zhangsan 用户分配 dbtest1 数据库中所有表的 查、改 权限</span></span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span>,<span class="keyword">UPDATE</span> <span class="keyword">ON</span> dbtest1.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;zhagnsan&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 给 zhangsan 用户分配所有数据库的所有操作权限，</span></span><br><span class="line"><span class="comment">-- 此时与 root 用户的区别只是无法给其他用户赋予权限。</span></span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">ALL</span> PRIVILEGES <span class="keyword">ON</span> <span class="operator">*</span>.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;zhagnsan&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看权限</span></span><br><span class="line"><span class="keyword">SHOW</span> GRANTS;</span><br><span class="line"><span class="keyword">SHOW</span> GRANTS <span class="keyword">FOR</span> <span class="built_in">CURRENT_USER</span>;</span><br><span class="line"><span class="keyword">SHOW</span> GRANTS <span class="keyword">FOR</span> <span class="built_in">CURRENT_USER</span>();</span><br><span class="line"><span class="keyword">SHOW</span> GRANTS <span class="keyword">FOR</span> <span class="string">&#x27;zhangsan&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 收回权限</span></span><br><span class="line"><span class="keyword">REVOKE</span> <span class="keyword">SELECT</span> <span class="keyword">ON</span> dbtest1.<span class="operator">*</span> <span class="keyword">FROM</span> <span class="string">&#x27;zhangsan&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 收回用户所有权限，需要 root 用户有 SYSTEM_USER 权限才能执行。</span></span><br><span class="line"><span class="keyword">GRANT</span> <span class="built_in">SYSTEM_USER</span> <span class="keyword">ON</span> <span class="operator">*</span>.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line"><span class="keyword">REVOKE</span> <span class="keyword">ALL</span> PRIVILEGES <span class="keyword">ON</span> <span class="operator">*</span>.<span class="operator">*</span> <span class="keyword">FROM</span> <span class="string">&#x27;zhagnsan&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 修改之后需要重新登录才能生效。</span></span><br></pre></td></tr></table></figure>

<h2 id="权限表"><a href="#权限表" class="headerlink" title="权限表"></a>权限表</h2><p>MySQL 服务器通过权限表来控制用户对数据库的访问，权限表存放在 mysql 这个数据库中。其中比较重要的是 <code>user</code>、<code>db</code> 两个表，此外还有 <code>tables_priv</code>、<code>columns_priv</code>、<code>procs_priv</code> 表等。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">user</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> db;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> tables_priv;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> columns_priv;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> procs_priv;</span><br></pre></td></tr></table></figure>

<h2 id="角色管理-MySQL-8-0"><a href="#角色管理-MySQL-8-0" class="headerlink" title="角色管理(MySQL 8.0)"></a>角色管理(MySQL 8.0)</h2><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 创建角色与赋予权限</span></span><br><span class="line"><span class="keyword">CREATE</span> role <span class="string">&#x27;manager&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span>,<span class="keyword">UPDATE</span> <span class="keyword">ON</span> dbtest1.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;manager&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看角色</span></span><br><span class="line"><span class="keyword">SHOW</span> GRANTS <span class="keyword">FOR</span> <span class="string">&#x27;manager&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 收回角色权限</span></span><br><span class="line"><span class="keyword">REVOKE</span> <span class="keyword">UPDATE</span> <span class="keyword">ON</span> dbtest1.<span class="operator">*</span> <span class="keyword">FROM</span> <span class="string">&#x27;manager&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除角色</span></span><br><span class="line"><span class="keyword">DROP</span> ROLE <span class="string">&#x27;manager&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 给用户赋予角色</span></span><br><span class="line"><span class="keyword">GRANT</span> <span class="string">&#x27;manager&#x27;</span>@<span class="string">&#x27;%&#x27;</span> <span class="keyword">TO</span> <span class="string">&#x27;zhangsan&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line"><span class="keyword">SHOW</span> GRANTS <span class="keyword">FOR</span> <span class="string">&#x27;zhangsan&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">CURRENT_ROLE</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 赋予角色之后需要激活才能生效</span></span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">DEFAULT</span> ROLE <span class="string">&#x27;manager&#x27;</span>@<span class="string">&#x27;%&#x27;</span> <span class="keyword">TO</span> <span class="string">&#x27;zhangsan&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line"><span class="comment">-- 退出之后重新查询：</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">CURRENT_ROLE</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 同时，也可以修改全局配置来自动激活</span></span><br><span class="line"><span class="keyword">SHOW</span> VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;activate_all_roles_on_login&#x27;</span>;</span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> activate_all_roles_on_login<span class="operator">=</span><span class="keyword">ON</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 撤销角色，只能用有权限的用户去撤销其他用户的角色。</span></span><br><span class="line"><span class="keyword">REVOKE</span> <span class="string">&#x27;manager&#x27;</span>@<span class="string">&#x27;%&#x27;</span> <span class="keyword">FROM</span> <span class="string">&#x27;zhangsan&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h1 id="存储引擎"><a href="#存储引擎" class="headerlink" title="存储引擎"></a>存储引擎</h1><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 显示存储引擎列表</span></span><br><span class="line"><span class="keyword">SHOW</span> ENGINES;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看默认存储引擎</span></span><br><span class="line"><span class="keyword">SHOW</span> VARIABLES <span class="keyword">LIKE</span> &quot;%storage_engine%&quot;;</span><br><span class="line"><span class="keyword">SELECT</span> @<span class="variable">@default</span>_storage_engine;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 修改默认存储引擎</span></span><br><span class="line"><span class="comment">-- 使用SQL语句修改的是临时，要永久修改，可以修改配置文件</span></span><br><span class="line"><span class="keyword">SET</span> DEFAULT_STORAGE_ENGINE<span class="operator">=</span>MYISAM;</span><br><span class="line"><span class="comment">-- 配置文件：</span></span><br><span class="line"><span class="keyword">default</span><span class="operator">-</span>storage<span class="operator">-</span>engine<span class="operator">=</span>MYISAM</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 设置表的引擎：</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tb1(id <span class="type">int</span>) engine<span class="operator">=</span>InnoDB;</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> tb1 engine<span class="operator">=</span>MyISAM;</span><br></pre></td></tr></table></figure>

<h2 id="InnoDB-与-MyISAM"><a href="#InnoDB-与-MyISAM" class="headerlink" title="InnoDB 与 MyISAM"></a>InnoDB 与 MyISAM</h2><p>MySQL 5.5 版本之前，默认采用 MyISAM 引擎，5.5 及之后的版本默认采用 InnoDB 引擎。</p>
<p>InnoDB: 支持外键、事务、行级锁，崩溃能自动恢复（基于事务）。由于支持行级锁，操作时不影响其他行，所以对高并发比较友好。InnoDB 不仅缓存索引，还缓存数据，所以比较占用内存，而且内存大小对性能有决定性影响。</p>
<p>MyISAM: 不支持外键、事务、行级锁，崩溃不能恢复。不支持行锁，只支持表锁，操作一条记录会锁住整个表，所以不适合高并发。只缓存索引，不缓存数据，占用内存较低。访问速度快，适合对事务完整性没有要求，或以增加查询为主的应用。</p>
<p>InnoDB 数据文件结构：</p>
<p>table.frm: 存储表结构（MySQL 8.0 时，合并在 table.ibd 中）<br>table.ibd：存储数据和索引</p>
<p>MyISAM 数据文件结构：</p>
<p>table.frm：存储表结构<br>table.MYD：存储数据<br>table.MYI：存储索引</p>
<h2 id="其他存储引擎"><a href="#其他存储引擎" class="headerlink" title="其他存储引擎"></a>其他存储引擎</h2><p>Archive：仅支持插入和查询两个功能，插入数据后不能修改。拥有很好的压缩机制，占用存储空间更小，适合存储大量作为历史记录的数据，拥有很高的插入速度，但是对查询的支持较差。</p>
<p>Blackhole：丢弃写操作，读操作返回空内容，不做任何保存。</p>
<p>CSV：储存数据时，以逗号分隔数据项。</p>
<p>Memory：数据放在内存中，只能存储长度不变的数据，无法持久化，断电丢失数据。</p>
<p>……</p>
<h1 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h1><p>通过 <code>SHOW ENGINES;</code> 命令可以查看所有存储引擎：</p>
<p><img src="/images/posts/p27-mysql/2-engines.jpg" alt="MySQL 存储引擎"></p>
<p>可以看到，只有 <code>InnoDB</code> 存储引擎支持事务。</p>
<h2 id="事务-ACID"><a href="#事务-ACID" class="headerlink" title="事务 ACID"></a>事务 ACID</h2><ul>
<li>原子性（atomicity）：事务是一个不可分割的工作单位，要么全部提交，要么全部失败回滚。</li>
<li>一致性（consistency）：指事务执行前后，数据从一个 <code>合法性状态</code> 变换到另外一个 <code>合法性状态</code>。</li>
<li>隔离型（isolation）：一个事务的执行 <code>不能被其他事务干扰</code> ，即一个事务内部的操作及使用的数据对 <code>并发</code> 的其他事务是隔离的，并发执行的各个事务之间不能互相干扰。</li>
<li>持久性（durability）：事务一旦被提交，它对数据库中数据的改变就是 <code>永久性的</code> ，接下来的其他操作和数据库故障不应该对其有任何影响。</li>
</ul>
<h2 id="事务开启"><a href="#事务开启" class="headerlink" title="事务开启"></a>事务开启</h2><p>事务开启有两种方式：<code>BEGIN</code> 和 <code>START TRANSACTION</code>。</p>
<p><code>START TRANSACTION</code> 开启事务时，可以指定属性：</p>
<ul>
<li>READ ONLY: 只读</li>
<li>READ WRITE: 默认，读写</li>
<li>WITH CONSISTENT SNAPSHOT: 一致性读</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 开启事务</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;  <span class="comment">-- BEGIN</span></span><br><span class="line"><span class="comment">-- DML 操作</span></span><br><span class="line"><span class="keyword">UPDATE</span> <span class="keyword">user</span> <span class="keyword">SET</span> name<span class="operator">=</span><span class="string">&#x27;张三&#x27;</span> <span class="keyword">WHERE</span> name<span class="operator">=</span><span class="string">&#x27;张三2&#x27;</span>;</span><br><span class="line"><span class="comment">-- 提交事务，事务结束。</span></span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"><span class="comment">-- 回滚整个事务，事务结束。</span></span><br><span class="line"><span class="keyword">ROLLBACK</span>;</span><br><span class="line"><span class="comment">-- 设置存档点</span></span><br><span class="line"><span class="keyword">SAVEPOINT</span> s1;</span><br><span class="line"><span class="comment">-- 回滚到某个存档点，事务不结束。</span></span><br><span class="line"><span class="keyword">ROLLBACK</span> <span class="keyword">TO</span> s1;</span><br></pre></td></tr></table></figure>

<h2 id="隐式事务"><a href="#隐式事务" class="headerlink" title="隐式事务"></a>隐式事务</h2><p>手动使用 SQL 语句控制的事务，叫做<code>显示事务</code>。</p>
<p>相对应的，也有<code>隐式事务</code>，在执行 SQL 时自动开启提交事务。</p>
<p>在上一个事务没有结束（没有提交或回滚）时，开启了一个新的事务，则上一个事务会自动提交。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查看自动提交是否开启</span></span><br><span class="line"><span class="keyword">SHOW</span> VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;autocommit&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 开启/关闭 自动提交</span></span><br><span class="line"><span class="keyword">SET</span> autocommit <span class="operator">=</span> <span class="keyword">ON</span>;  <span class="comment">-- 1</span></span><br><span class="line"><span class="keyword">SET</span> autocommit <span class="operator">=</span> OFF;  <span class="comment">-- 0</span></span><br></pre></td></tr></table></figure>

<h2 id="隔离级别"><a href="#隔离级别" class="headerlink" title="隔离级别"></a>隔离级别</h2><p>查看 MySQL 默认隔离级别：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- MySQL 5.7 版本叫 tx_isolation，</span></span><br><span class="line"><span class="comment">-- MySQL 8.0 版本叫 transaction_isolation</span></span><br><span class="line"><span class="keyword">SHOW</span> VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;%isolation&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看全局变量，5.7 和 8.0 都可以用。</span></span><br><span class="line"><span class="keyword">SELECT</span> @<span class="variable">@transaction</span>_isolation;</span><br></pre></td></tr></table></figure>

<p>修改 MySQL 隔离级别：</p>
<p>修改 GLOBAL 隔离级别，对已经存在的 Session 无效，对后续新的 Session 生效。</p>
<p>修改 SESSION 隔离级别，对当前会话已经存在的事务无效，对后续新的事务生效。</p>
<p>GLOBAL 和 SESSION 都是内存级别的配置，重启 MySQL 服务器之后会恢复成默认值。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SET</span> [<span class="keyword">GLOBAL</span> <span class="operator">|</span> SESSION] TRANSACTION ISOLATION LEVEL 隔离级别;</span><br><span class="line"><span class="comment">-- 隔离级别: </span></span><br><span class="line"><span class="comment">-- READ UNCOMMITTED</span></span><br><span class="line"><span class="comment">-- READ COMMITTED</span></span><br><span class="line"><span class="comment">-- REPEATABLE READ</span></span><br><span class="line"><span class="comment">-- SERIALIZABLE</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SET</span> [<span class="keyword">GLOBAL</span> <span class="operator">|</span> SESSION] TRANSACTION_ISOLATION<span class="operator">=</span><span class="string">&#x27;隔离级别&#x27;</span>;</span><br><span class="line"><span class="comment">-- 隔离级别格式:</span></span><br><span class="line"><span class="comment">-- READ-UNCOMMITTED</span></span><br><span class="line"><span class="comment">-- READ-COMMITTED</span></span><br><span class="line"><span class="comment">-- REPEATABLE-READ</span></span><br><span class="line"><span class="comment">-- SERIALIZABLE</span></span><br></pre></td></tr></table></figure>




<h1 id="性能分析"><a href="#性能分析" class="headerlink" title="性能分析"></a>性能分析</h1><p><img src="/images/posts/p27-mysql/1-SQL%E5%88%86%E6%9E%90.jpg" alt="SQL 分析"></p>
<h2 id="查看系统参数"><a href="#查看系统参数" class="headerlink" title="查看系统参数"></a>查看系统参数</h2><p>在MySQL中，可以使用 SHOW STATUS 语句查询一些MySQL数据库服务器的 <code>性能参数</code>、<code>执行频率</code>。</p>
<p>SHOW STATUS语句语法如下：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> [<span class="keyword">GLOBAL</span><span class="operator">|</span>SESSION] STATUS <span class="keyword">LIKE</span> <span class="string">&#x27;参数&#x27;</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查看 MySQL 服务器的连接次数</span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">GLOBAL</span> STATUS <span class="keyword">LIKE</span> <span class="string">&#x27;Connections&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看 MySQL 服务器的在线时间（秒）</span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">GLOBAL</span> STATUS <span class="keyword">LIKE</span> <span class="string">&#x27;Uptime&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看 MySQL 服务器的慢查询次数</span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">GLOBAL</span> STATUS <span class="keyword">LIKE</span> <span class="string">&#x27;Slow_queries&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看 SELECT、INSERT、UPDATE、DELETE 返回的行数</span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">GLOBAL</span> STATUS <span class="keyword">LIKE</span> <span class="string">&#x27;Innodb_rows_read&#x27;</span>;</span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">GLOBAL</span> STATUS <span class="keyword">LIKE</span> <span class="string">&#x27;Innodb_rows_inserted&#x27;</span>;</span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">GLOBAL</span> STATUS <span class="keyword">LIKE</span> <span class="string">&#x27;Innodb_rows_updated&#x27;</span>;</span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">GLOBAL</span> STATUS <span class="keyword">LIKE</span> <span class="string">&#x27;Innodb_rows_deleted&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看 SELECT、INSERT、UPDATE、DELETE 操作次数</span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">GLOBAL</span> STATUS <span class="keyword">LIKE</span> <span class="string">&#x27;Com_select&#x27;</span>;</span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">GLOBAL</span> STATUS <span class="keyword">LIKE</span> <span class="string">&#x27;Com_insert&#x27;</span>;</span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">GLOBAL</span> STATUS <span class="keyword">LIKE</span> <span class="string">&#x27;Com_update&#x27;</span>;</span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">GLOBAL</span> STATUS <span class="keyword">LIKE</span> <span class="string">&#x27;Com_delete&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看上一次查询数据检索了多少个页</span></span><br><span class="line"><span class="keyword">SHOW</span> STATUS <span class="keyword">LIKE</span> <span class="string">&#x27;last_query_cost&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询慢查询日志状态</span></span><br><span class="line"><span class="keyword">SHOW</span> VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;%slow_query_log%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 开启慢查询</span></span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> slow_query_log <span class="operator">=</span> <span class="keyword">ON</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询慢查询阈值（秒）</span></span><br><span class="line"><span class="keyword">SHOW</span> VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;%long_query_time%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 修改慢查询阈值（SESSION、GLOBAL）</span></span><br><span class="line"><span class="keyword">SET</span> long_query_time <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> long_query_time <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 设置记录最小行数（达到该值才会记录慢查询）</span></span><br><span class="line"><span class="comment">-- 比如设置为 1000，表示至少有 1000 行记录并且超过慢查询阈值才会记录。</span></span><br><span class="line"><span class="keyword">SET</span> min_examined_row_limit <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除慢查询日志</span></span><br><span class="line">mysqladmin <span class="operator">-</span>uroot <span class="operator">-</span>p flush<span class="operator">-</span>logs slow</span><br></pre></td></tr></table></figure>

<h2 id="mysqldumpslow"><a href="#mysqldumpslow" class="headerlink" title="mysqldumpslow"></a>mysqldumpslow</h2><table>
<thead>
<tr>
<th align="left">param</th>
<th align="left">description</th>
</tr>
</thead>
<tbody><tr>
<td align="left">–verbose</td>
<td align="left">verbose</td>
</tr>
<tr>
<td align="left">–debug</td>
<td align="left">debug</td>
</tr>
<tr>
<td align="left">–help</td>
<td align="left">write this text to standard output</td>
</tr>
<tr>
<td align="left">-v</td>
<td align="left">verbose</td>
</tr>
<tr>
<td align="left">-d</td>
<td align="left">debug</td>
</tr>
<tr>
<td align="left">-s ORDER</td>
<td align="left">what to sort by (al,at,ar,c,l,r,t),’at’is default</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">al:average lock time</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">ar:average rows sent</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">at:average query time</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">c:count</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">l:lock time</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">r:rows sent</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">t:query time</td>
</tr>
<tr>
<td align="left">-r</td>
<td align="left">reverse the sort order (largest last instead of first)</td>
</tr>
<tr>
<td align="left">-t NUM</td>
<td align="left">just show the top n queries</td>
</tr>
<tr>
<td align="left">-a</td>
<td align="left">don’t abstract all numbers to N and strings to ‘S’</td>
</tr>
<tr>
<td align="left">-n NUM</td>
<td align="left">abstract numbers with at least n digits within names</td>
</tr>
<tr>
<td align="left">-g PATTERN</td>
<td align="left">grep:only consider stmts that include this string</td>
</tr>
<tr>
<td align="left">-h HOSTNAME</td>
<td align="left">hostname of db server for <em>-slow.log filename (can be wildcard), default is ‘</em>‘, i.e.match all</td>
</tr>
<tr>
<td align="left">-i NAME</td>
<td align="left">name of server instance (if using mysql.server startup script)</td>
</tr>
<tr>
<td align="left">-l</td>
<td align="left">don’t subtract lock time from total time</td>
</tr>
</tbody></table>
<ul>
<li>-a: 不将数字抽象成N，字符串抽象成S</li>
<li>-s: 是表示按照何种方式排序：<ul>
<li>c: 访问次数</li>
<li>l: 锁定时间</li>
<li>r: 返回记录</li>
<li>t: 查询时间</li>
<li>al:平均锁定时间</li>
<li>ar:平均返回记录数</li>
<li>at:平均查询时间 （默认方式）</li>
<li>ac:平均查询次数</li>
</ul>
</li>
<li>-t: 即为返回前面多少条的数据；</li>
<li>-g: 后边搭配一个正则匹配模式，大小写不敏感的；</li>
</ul>
<p>常用命令：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">得到返回记录集最多的10个SQL</span></span><br><span class="line">mysqldumpslow -s r -t 10 /var/lib/mysql/xxx-slow.log</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">得到访问次数最多的10个SQL</span></span><br><span class="line">mysqldumpslow -s c -t 10 /var/lib/mysql/xxx-slow.log</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">得到按照时间排序的前10条里面含有左连接的查询语句</span></span><br><span class="line">mysqldumpslow -s t -t 10 -g &quot;left join&quot; /var/lib/mysql/xxx-slow.log</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">另外建议在使用这些命令时结合 | 和more 使用 ，否则有可能出现爆屏情况</span></span><br><span class="line">mysqldumpslow -s r -t 10 /var/lib/mysql/xxx-slow.log | more</span><br></pre></td></tr></table></figure>

<h2 id="SHOW-PROFILING"><a href="#SHOW-PROFILING" class="headerlink" title="SHOW PROFILING"></a>SHOW PROFILING</h2><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查询开启 PROFILING</span></span><br><span class="line"><span class="keyword">SHOW</span> VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;profiling&#x27;</span>;</span><br><span class="line"><span class="keyword">SET</span> profiling <span class="operator">=</span> <span class="string">&#x27;ON&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看语句列表</span></span><br><span class="line"><span class="keyword">SHOW</span> PROFILES;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看上一次查询各个阶段的执行时间</span></span><br><span class="line"><span class="keyword">SHOW</span> PROFILE;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看指定语句的执行时间（通过 SHOW PROFILES; 获取列表）</span></span><br><span class="line"><span class="keyword">SHOW</span> PROFILE cpu,block io <span class="keyword">FOR</span> QUERY <span class="number">3</span>;</span><br></pre></td></tr></table></figure>

<p>SHOW PROFILE 的常用查询参数：</p>
<ul>
<li>ALL：显示所有的开销信息。 </li>
<li>BLOCK IO：显示块IO开销。 </li>
<li>CONTEXT SWITCHES：上下文切换开销。 </li>
<li>CPU：显示CPU开销信息。 </li>
<li>IPC：显示发送和接收开销信息。 </li>
<li>MEMORY：显示内存开销信息。 </li>
<li>PAGE FAULTS：显示页面错误开销信息。 </li>
<li>SOURCE：显示和Source_function，Source_file，Source_line相关的开销信息。 </li>
<li>SWAPS：显示交换次数开销信息。</li>
</ul>
<h2 id="EXPLAIN-amp-DESCRIBE"><a href="#EXPLAIN-amp-DESCRIBE" class="headerlink" title="EXPLAIN &amp; DESCRIBE"></a>EXPLAIN &amp; DESCRIBE</h2><p>官网介绍：</p>
<p><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/explain-output.html">https://dev.mysql.com/doc/refman/5.7/en/explain-output.html</a></p>
<p><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/explain-output.html">https://dev.mysql.com/doc/refman/8.0/en/explain-output.html</a></p>
<p>使用非常简单，只需要在执行语句前加上 EXPLAIN 或 DESCRIBE 关键字即可。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> article;</span><br></pre></td></tr></table></figure>

<p>EXPLAIN 语句输出的各个列的作用如下：</p>
<table>
<thead>
<tr>
<th align="left">列名</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">id</td>
<td align="left">在一个大的查询语句中每个SELECT关键字都对应一个 唯一的id</td>
</tr>
<tr>
<td align="left">select_type</td>
<td align="left">SELECT 关键字对应的那个查询的类型</td>
</tr>
<tr>
<td align="left">table</td>
<td align="left">表名</td>
</tr>
<tr>
<td align="left">partitions</td>
<td align="left">匹配的分区信息</td>
</tr>
<tr>
<td align="left">type</td>
<td align="left">针对单表的访问方法</td>
</tr>
<tr>
<td align="left">possible_keys</td>
<td align="left">可能用到的索引</td>
</tr>
<tr>
<td align="left">key</td>
<td align="left">实际上使用的索引</td>
</tr>
<tr>
<td align="left">key_len</td>
<td align="left">实际使用到的索引长度</td>
</tr>
<tr>
<td align="left">ref</td>
<td align="left">当使用索引列等值查询时，与索引列进行等值匹配的对象信息</td>
</tr>
<tr>
<td align="left">rows</td>
<td align="left">预估的需要读取的记录条数</td>
</tr>
<tr>
<td align="left">filtered</td>
<td align="left">某个表经过搜索条件过滤后剩余记录条数的百分比</td>
</tr>
<tr>
<td align="left">Extra</td>
<td align="left">一些额外的信息</td>
</tr>
</tbody></table>
<h1 id="索引-amp-优化"><a href="#索引-amp-优化" class="headerlink" title="索引 &amp; 优化"></a>索引 &amp; 优化</h1><p>从功能上说，索引可以分为4种：分别是 <code>普通索引</code>、<code>唯一索引</code>、<code>主键索引</code>、<code>全文索引</code>。<br>按照物理实现方式划分，可以分为 <code>聚簇索引</code> 和 <code>非聚簇索引</code>。<br>按照作用字段个数划分，可以分为 <code>单列索引</code> 和 <code>联合索引</code>。</p>
<h2 id="索引创建与删除"><a href="#索引创建与删除" class="headerlink" title="索引创建与删除"></a>索引创建与删除</h2><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 添加索引</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> emp(</span><br><span class="line">  emp_id <span class="type">INT</span> <span class="keyword">PRIMARY</span> KEY AUTO_INCREMENT,  <span class="comment">-- 主键索引</span></span><br><span class="line">  emp_name <span class="type">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">UNIQUE</span>,  <span class="comment">-- 唯一约束</span></span><br><span class="line">  dept_id <span class="type">INT</span>,</span><br><span class="line">  <span class="comment">-- 外键索引</span></span><br><span class="line">  <span class="keyword">CONSTRAINT</span> emp_dept_id_fk <span class="keyword">FOREIGN</span> KEY(dept_id) <span class="keyword">REFERENCES</span> dept(dept_id)</span><br><span class="line">  <span class="comment">-- 声明其他索引</span></span><br><span class="line">  INDEX idx_bname(book_name),  <span class="comment">-- 普通索引，括号内是表里的字段</span></span><br><span class="line">  <span class="comment">-- 唯一索引，唯一索引和唯一约束关联，创建一个会自动创建另一个</span></span><br><span class="line">  <span class="keyword">UNIQUE</span> INDEX uk_idx_bname(book_name),</span><br><span class="line">  FULLTEXT INDEX futxt_idx_info(info)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> book2 <span class="keyword">ADD</span> INDEX idx_cmt(comment);</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> book2 <span class="keyword">ADD</span> <span class="keyword">UNIQUE</span> uk_idx_cmt(comment);</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> book2 <span class="keyword">ADD</span> INDEX mul_bid_bname(bid, bname);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_cmt <span class="keyword">ON</span> book(comment)</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">UNIQUE</span> INDEX uk_idx_cmt <span class="keyword">ON</span> book(comment)</span><br><span class="line"><span class="keyword">CREATE</span> INDEX mul_bid_bname <span class="keyword">ON</span> book(bid, bname);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看索引</span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> book;</span><br><span class="line"><span class="keyword">SHOW</span> INDEX <span class="keyword">FROM</span> book;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除索引</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> book <span class="keyword">DROP</span> INDEX idx_cmt;</span><br><span class="line"><span class="keyword">DROP</span> INDEX idx_cmt <span class="keyword">ON</span> book;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看 SQL 的索引使用情况：只需要在 SQL 前面加 EXPLAIN 关键字即可。</span></span><br><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> tb1 <span class="keyword">WHERE</span> name <span class="operator">=</span> <span class="string">&#x27;zhangsan&#x27;</span></span><br></pre></td></tr></table></figure>


<h2 id="适合创建索引的情况"><a href="#适合创建索引的情况" class="headerlink" title="适合创建索引的情况"></a>适合创建索引的情况</h2><ol>
<li><p>字段数值有唯一性的限制</p>
</li>
<li><p>频繁作为 WHERE 查询条件的字段</p>
</li>
<li><p>经常 GROUP BY 和 ORDER BY 的列</p>
</li>
<li><p>UPDATE、DELETE 的 WHERE 条件列</p>
</li>
<li><p>DISTINCT 字段需要创建索引</p>
<ul>
<li>索引会对数据按照某种顺序进行排序，所以在去重的时候也会快很多</li>
</ul>
</li>
<li><p>多表 JOIN 连接操作时，创建索引注意事项</p>
<ul>
<li><p>连接表的数量尽量不要超过 3 张 ，因为每增加一张表就相当于增加了一次嵌套的循环，数量级增<br>长会非常快，严重影响查询的效率。</p>
</li>
<li><p>对 WHERE 条件创建索引 ，因为 WHERE 才是对数据条件的过滤。如果在数据量非常大的情况下，<br>没有 WHERE 条件过滤是非常可怕的。</p>
</li>
<li><p>对用于连接的字段创建索引，并且该字段在多张表中的 <code>类型必须一致</code>。类型不一致会隐式调用函数，从而索引失效。</p>
</li>
</ul>
</li>
<li><p>使用列的类型小的创建索引</p>
</li>
<li><p>使用字符串前缀创建索引</p>
</li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 通过以下 SQL 来计算：</span></span><br><span class="line"><span class="comment">-- 先计算字段在全部数据中的比例：</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> address) <span class="operator">/</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">FROM</span> SHOP;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 截取不同长度计算，与全表的数据对比：</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line"><span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> <span class="keyword">LEFT</span>(address, <span class="number">10</span>)) <span class="operator">/</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">AS</span> subl1,</span><br><span class="line"><span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> <span class="keyword">LEFT</span>(address, <span class="number">15</span>)) <span class="operator">/</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">AS</span> subl1,</span><br><span class="line"><span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> <span class="keyword">LEFT</span>(address, <span class="number">20</span>)) <span class="operator">/</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">AS</span> subl1,</span><br><span class="line"><span class="keyword">FROM</span> SHOP;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 越接近 1，表示重复度越低</span></span><br></pre></td></tr></table></figure>

<ol start="9">
<li><p>区分度高(散列性高)的列适合作为索引</p>
</li>
<li><p>使用最频繁的列放到联合索引的左侧</p>
</li>
<li><p>在多个字段都要创建索引的情况下，联合索引优于单值索引</p>
</li>
</ol>
<p>在实际工作中，我们也需要注意平衡，索引的数目不是越多越好。我们需要限制每张表上的索引数量，建议单张表索引数量不超过6个。原因：</p>
<p>① 每个索引都需要占用磁盘空间，索引越多，需要的磁盘空间就越大。</p>
<p>② 索引会影响 INSERT、DELETE、UPDATE 等语句的性能，因为表中的数据更改的同时，索引也会进行调整和更新，会造成负担。</p>
<p>③ 优化器在选择如何优化查询时，会根据统一信息，对每一个可以用到的索引来进行评估，以生成出一个最好的执行计划，如果同时有很多个索引都可以用于查询，会增加 MySQL 优化器生成执行计划时间，降低查询性能。</p>
<h2 id="不适合创建索引的情况"><a href="#不适合创建索引的情况" class="headerlink" title="不适合创建索引的情况"></a>不适合创建索引的情况</h2><ol>
<li><p>在 WHERE、GROUP BY、ORDER BY 中不用创建索引。</p>
</li>
<li><p>数据量小的表中不用创建索引（少于 1000 条）。</p>
</li>
<li><p>有大量重复数据的列上不用创建索引（例如性别）。</p>
</li>
<li><p>避免对经常更新的表创建过多索引（增删改数据时需要维护索引）。</p>
</li>
<li><p>不建议用无序的值作为索引。</p>
</li>
<li><p>删除不再使用或很少使用的索引。</p>
</li>
<li><p>不要定义冗余或重复的索引。</p>
<p> 例如 index(a, b, c) 相当于 index(a)、index(a, b)、index(a, b, c)</p>
</li>
</ol>
<p>索引是一把双刃剑，可提高查询效率，但也会降低插入和更新的速度并占用磁盘空间！</p>
<h2 id="索引失效的情况"><a href="#索引失效的情况" class="headerlink" title="索引失效的情况"></a>索引失效的情况</h2><ol>
<li>字符串模糊查询以 <code>&#39;%&#39;</code> 开头。</li>
<li>对建立索引的列使用函数。或者隐式使用函数，如类型不一致、数据库和表字符集不一致，都会隐式使用函数进行转换，从而索引失效。</li>
<li>使用 <code>OR</code> 关键字时，有一方没有索引。</li>
<li>范围比较不会使用索引。WHERE 语句里有多个联合索引的字段时，如果索引中的某个字段存在范围比较，如 <code>age &gt; 20</code>，则联合索引中 age 字段及之后的字段都不会使用索引。所以建立联合索引时尽量将可能进行范围比较的字段放在最后面。</li>
<li>不等于 <code>!= 或者 &lt;&gt;</code> 或 <code>is not null</code> 不会使用索引。<code>is null</code> 可以使用索引。但是经过编译器优化后，部分 <code>is not null</code> 也能使用索引。</li>
<li>进行列比较时：select name from table where id = age;</li>
<li>使用 select *.<br>…</li>
</ol>
<h2 id="查询优化"><a href="#查询优化" class="headerlink" title="查询优化"></a>查询优化</h2><p><strong>内外连接：</strong></p>
<p>LEFT JOIN 左外连接查询时，驱动表无法避免全表扫描，可以给被驱动表加索引进行优化，保证被驱动表的 JOIN 字段存在索引。</p>
<p>INNER JOIN 内连接中，查询优化器可以决定谁作为驱动表，谁作为被驱动表。两个表的连接条件都存在索引或都不存在索引时，会选择小表作为驱动表。两个表的连接条件只有一个存在索引时，存在索引的表会被作为被驱动表。</p>
<p>能够直接多表关联的尽量直接关联，不用子查询。(减少查询的趟数)</p>
<p>不建议使用子查询，建议将子查询SQL拆开结合程序多次查询，或使用 JOIN 来代替子查询。子查询会创建临时表，临时表没有索引。</p>
<p>尽量不要使用 NOT IN 或者 NOT EXISTS，用LEFT JOIN xxx ON xx WHERE xx IS NULL 替代。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student stu1</span><br><span class="line"><span class="keyword">WHERE</span> stu1.stuno <span class="keyword">IN</span> (<span class="keyword">SELECT</span> monitor <span class="keyword">FROM</span> class c <span class="keyword">WHERE</span> monitor <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 转换为：</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student stu1 <span class="keyword">JOIN</span> class c</span><br><span class="line"><span class="keyword">ON</span> stu1.stuno <span class="operator">=</span> c.monitor</span><br><span class="line"><span class="keyword">WHERE</span> c.monitor <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span></span><br></pre></td></tr></table></figure>

<p><strong>排序优化：</strong></p>
<p>SQL 中，可以在 WHERE 子句和 ORDER BY 子句中使用索引，目的是在 WHERE 子句中 避免全表扫<br>描 ，在 ORDER BY 子句 避免使用 FileSort 排序 。当然，某些情况下全表扫描，或者 FileSort 排<br>序不一定比索引慢。但总的来说，我们还是要避免，以提高查询效率。</p>
<p><strong>GROUP BY优化：</strong></p>
<p><strong>分页查询优化：</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 从第 2000000 万条数据开始查询 10 条记录</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student LIMIT <span class="number">2000000</span>,<span class="number">10</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 优化一：在索引上完成排序分页操作，</span></span><br><span class="line"><span class="comment">-- 最后根据主键关联回原表查询所需要的其他列内容。</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student t,</span><br><span class="line">(<span class="keyword">SELECT</span> id <span class="keyword">FROM</span> student <span class="keyword">ORDER</span> <span class="keyword">BY</span> id LIMIT <span class="number">2000000</span>,<span class="number">10</span>) a</span><br><span class="line"><span class="keyword">WHERE</span> t.id <span class="operator">=</span> a.id;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 优化二：该方案适用于主键自增的表，可以把 Limit 查询转换成某个位置的查询。</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> id <span class="operator">&gt;</span> <span class="number">2000000</span> LIMIT <span class="number">10</span>;</span><br></pre></td></tr></table></figure>

<h2 id="字符串前缀索引"><a href="#字符串前缀索引" class="headerlink" title="字符串前缀索引"></a>字符串前缀索引</h2><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 取 email 的前 6 个字符作为索引</span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_1 <span class="keyword">ON</span> student(email(<span class="number">6</span>))</span><br></pre></td></tr></table></figure>

<p>前缀索引会导致匹配结果变多，回表操作变多，增加IO。但是会更节省空间。</p>
<p>定义合适的长度作为索引，区分度高，能节省空间同时又不额外增加太多查询成本。</p>
<h2 id="覆盖索引"><a href="#覆盖索引" class="headerlink" title="覆盖索引"></a>覆盖索引</h2><p>当 SELECT、JOIN 和 WHERE 中的所有列都存在索引，此时只需要在非聚簇索引中查找数据，不需要进行回表操作，节省了IO，提高性能。</p>
<h2 id="索引下推"><a href="#索引下推" class="headerlink" title="索引下推"></a>索引下推</h2><p>Index Condition Pushdown(ICP) 是 MySQL 5.6 中新特性，是一种在存储引擎层使用索引过滤数据的一种优化方式。ICP 可以减少存储引擎访问基表的次数以及 MySQL 服务器访问存储引擎的次数。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 创建一个联合索引</span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_1 <span class="keyword">ON</span> student(name, age);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 在以下语句中，先从索引中查询到所有 age = 18 的数据，</span></span><br><span class="line"><span class="comment">-- 此时并不着急回表判断，而是直接在索引数据中判断 name like &#x27;%张%&#x27;</span></span><br><span class="line"><span class="comment">-- 最后将结果回表取出全部行数据。叫做索引下推。</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student</span><br><span class="line"><span class="keyword">WHERE</span> age <span class="operator">=</span> <span class="number">18</span></span><br><span class="line"><span class="keyword">AND</span> name <span class="keyword">like</span> <span class="string">&#x27;%张%&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h2 id="其他优化策略"><a href="#其他优化策略" class="headerlink" title="其他优化策略"></a>其他优化策略</h2><p><strong>EXISTS &amp; IN：</strong></p>
<p><strong>COUNT(1) COUNT(*) COUNT(字段)：</strong></p>
<p>在 MyISAM 引擎中，每张表都存在一个 row_count 值用来记录行数量，三条语句都是直接返回数量。</p>
<p>在 InnoDB 中，由于最小粒度是行锁，读取行数量同时可能会增删数据，所以不存在统计行数的字段。</p>
<p>在 InnoDB 中，如果要使用 COUNT(字段)，尽量使用非聚簇索引的字段，非聚簇索引的数据量比聚簇索引少很多。</p>
<p>COUNT(*) 和 COUNT(1) 会自动采用占用空间更小的非聚簇索引来统计。</p>
<p><strong>SELECT *：</strong></p>
<p>SELECT * 会被自动转换成 SELECT + 所有列名，转换过程需要占用一定性能。</p>
<p>SELECT * 无法使用覆盖索引。</p>
<p><strong>LIMIT 1：</strong></p>
<p>在 <code>全表扫描</code> 时，如果确定结果只有一条，那么在加上 LIMIT 1 之后，当找到一条数据时，会直接返回，不需要再继续查找，能加快速度。</p>
<p>如果存在唯一索引，则不需要加上 LIMIT 1。</p>
<p><strong>COMMIT：</strong></p>
<p>在程序中多提交事务(COMMIT)，提交之后会释放资源：</p>
<ul>
<li>回滚段上用于恢复数据的信息</li>
<li>被程序语句获得的锁</li>
<li>redo / undo log buffer 中的空间</li>
<li>管理上述 3 种资源的内部花费</li>
</ul>
<h1 id="数据库调优"><a href="#数据库调优" class="headerlink" title="数据库调优"></a>数据库调优</h1><ul>
<li>尽可能 <code>节省系统资源</code> ，以便系统可以提供更大负荷的服务。（吞吐量更大）</li>
<li>合理的结构设计和参数调整，以提高用户操作 <code>响应的速度</code> 。（响应速度更快）</li>
<li>减少系统的瓶颈，提高MySQL数据库整体的性能。</li>
</ul>
<p>我们需要调优的对象是整个数据库管理系统，它不仅包括 SQL 查询，还包括数据库的部署配置、架构等。从这个角度来说，我们思考的维度就不仅仅局限在 SQL 优化上了。通过如下的步骤我们进行梳理：</p>
<h2 id="选择-DBMS"><a href="#选择-DBMS" class="headerlink" title="选择 DBMS"></a>选择 DBMS</h2><h2 id="优化表设计"><a href="#优化表设计" class="headerlink" title="优化表设计"></a>优化表设计</h2><h2 id="优化逻辑查询"><a href="#优化逻辑查询" class="headerlink" title="优化逻辑查询"></a>优化逻辑查询</h2><p>SQL 查询优化，可以分为逻辑查询优化和物理查询优化。逻辑查询优化就是通过改变 SQL 语句的内容让 SQL 执行效率更高效，采用的方式是对 SQL 语句进行等价变换，对查询进行重写。</p>
<p>SQL 的查询重写包括了子查询优化、等价谓词重写、视图重写、条件简化、连接消除和嵌套连接消除等。</p>
<h2 id="优化物理查询"><a href="#优化物理查询" class="headerlink" title="优化物理查询"></a>优化物理查询</h2><p>物理查询优化是在确定了逻辑查询优化之后，采用物理优化技术（比如索引等），通过计算代价模型对各种可能的访问路径进行估算，从而找到执行方式中代价最小的作为执行计划。</p>
<p>SQL 查询时需要对不同的数据表进行查询，因此在物理查询优化阶段也需要确定这些查询所采用的路径，具体的情况包括：</p>
<ol>
<li><p>单表扫描：对于单表扫描来说，可以全表扫描所有的数据，也可以局部扫描。</p>
</li>
<li><p>两张表的连接：常用的连接方式包括了嵌套循环连接、HASH 连接和合并连接。</p>
</li>
<li><p>多张表的连接：多张数据表进行连接的时候，顺序很重要，因为不同的连接路径查询的效率不同，搜索空间也会不同。在进行多表连接的时候，搜索空间可能会达到很高的数据量级，巨大的搜索空间显然会占用更多的资源，因此需要通过调整连接顺序，将搜索空间调整在一个可接受的范围内。</p>
</li>
</ol>
<h2 id="使用内存数据库"><a href="#使用内存数据库" class="headerlink" title="使用内存数据库"></a>使用内存数据库</h2><p>使用 Redis 或 Memcached。</p>
<h2 id="库级优化"><a href="#库级优化" class="headerlink" title="库级优化"></a>库级优化</h2><p>库级优化是站在数据库的维度上进行的优化策略，比如控制一个库中的数据表数量。另外，单一的数据库总会遇到各种限制，不如取长补短，利用 “外援” 的方式。通过 <code>主从架构</code> 优化我们的读写策略，通过对数据库进行垂直或者水平切分，突破单一数据库或数据表的访问限制，提升查询的性能。</p>
<p><strong>读写分离：</strong></p>
<p>如果读和写的业务量都很大，并且它们都在同一个数据库服务器中进行操作，那么数据库的性能就会出现瓶颈这时为了提升系统的性能，优化用户体验，我们可以采用 <code>读写分离</code> 的方式降低主数据库的负载，比如用主数据库(master)完成写操作，用从数据库(slave)完成读操作。</p>
<p><strong>数据分片：</strong></p>
<p>对数据库分库分表。当数据量级达到干万级以上时，有时候我们需要把一个数据库切成多份，放到不同数据库服务器上，减少对单一数据库服务器的访问压力。</p>
<p>如果用的是 MySQL,就可以使用 MySQL 自带的分区表功能，当然也可以考虑自己做垂直拆分（分库）、水平拆分（分表）、垂直+水平拆分（分库分表）。</p>
<h2 id="大表优化"><a href="#大表优化" class="headerlink" title="大表优化"></a>大表优化</h2><p><strong>读写分离：</strong></p>
<p>一主一从，双主双从。</p>
<p><strong>垂直拆分：</strong></p>
<p>优点：可以使得列数据变小，在查询时减少读取的 Block 数，减少 I/O 次数。此外，垂直分区可以简化表的结构，易于维护。</p>
<p>缺点： 主键会出现冗余，需要管理冗余列，并会引起 JOIN 操作。此外，垂直拆分会让事务变得更加复杂。</p>
<p><strong>水平拆分：</strong></p>
<h2 id="优化参数配置"><a href="#优化参数配置" class="headerlink" title="优化参数配置"></a>优化参数配置</h2><p><code>innodb_buffer_pool_size</code>：这个参数是 Mysql 数据库最重要的参数之一，表示 InnoDB 类型的 <code>表和索引的最大缓存</code>。它不仅仅缓存 <code>索引数据</code>，还会缓存 <code>表的数据</code>。这个值越大，查询的速度就会越快。但是这个值太大会影响操作系统的性能。</p>
<p><code>key_buffer_size</code>：表示 <code>索引缓冲区的大小</code> 。索引缓冲区是所有的 <code>线程共享</code> 。增加索引缓冲区可以得到更好处理的索引（对所有读和多重写）。当然，这个值不是越大越好，它的大小取决于内存的大小。如果这个值太大，就会导致操作系统频繁换页，也会降低系统性能。对于内存在 4GB 左右的服务器该参数可设置为 <code>256M</code> 或 <code>384M</code>。</p>
<p><code>table_cache</code>：表示 <code>同时打开的表的个数</code> 。这个值越大，能够同时打开的表的个数越多。物理内存越大，设置就越大。默认为 2402，调到 512-1024 最佳。这个值不是越大越好，因为同时打开的表太多会影响操作系统的性能。</p>
<p><code>query_cache_size</code>：表示 <code>查询缓冲区的大小</code> 。可以通过在 MySQL 控制台观察，如果 <code>Qcache_lowmem_prunes</code> 的值非常大，则表明经常出现缓冲不够的情况，就要增加 <code>Query_cache_size</code> 的值；如果 <code>Qcache_hits</code> 的值非常大，则表明查询缓冲使用非常频繁，如果该值较小反而会影响效率，那么可以考虑不用查询缓存；<code>Qcache_free_blocks</code>，如果该值非常大，则表明缓冲区中碎片很多。MySQL 8.0 之后失效。该参数需要和 <code>query_cache_type</code> 配合使用。</p>
<p><code>query_cache_type=0</code> 时，所有的查询都不使用查询缓存区。但是 <code>query_cache_type=1</code> 并不会导致 MySQL 释放 <code>query_cache_size</code> 所配置的缓存区内存。<br><code>query_cache_type=1</code> 时，所有的查询都将使用查询缓存区，除非在查询语句中指定 SQL_NO_CACHE ，如 SELECT SQL_NO_CACHE * FROM tbl_name。<br><code>query_cache_type=2</code> 时，只有在查询语句中使用 SQL_CACHE 关键字，查询才会使用查询缓存区。使用查询缓存区可以提高查询的速度，这种方式只适用于修改操作少且经常执行相同的查询操作的情况。</p>
<p><code>sort_buffer_size</code>：表示每个 <code>需要进行排序的线程分配的缓冲区的大小</code>。增加这个参数的值可以提高 ORDER BY 或 GROUP BY 操作的速度。默认数值是 2 097 144 字节（约2MB）。对于内存在 4GB 左右的服务器推荐设置为 6-8M，如果有 100 个连接，那么实际分配的总共排序缓冲区大小为 100 × 6 = 600MB。</p>
<p><code>join_buffer_size = 8M</code>：表示 <code>联合查询操作所能使用的缓冲区大小</code> ，和 <code>sort_buffer_size</code> 一样，该参数对应的分配内存也是每个连接独享。</p>
<p><code>read_buffer_size</code>：表示 <code>每个线程连续扫描时为扫描的每个表分配的缓冲区的大小（字节）</code> 。当线程从表中连续读取记录时需要用到这个缓冲区。SET SESSION read_buffer_size=n 可以临时设置该参数的值。默认为64K，可以设置为4M。</p>
<p><code>innodb_flush_log_at_trx_commit</code>：表示 <code>何时将缓冲区的数据写入日志文件</code>，并且将日志文件写入磁盘中。该参数对于 InnoDB 引擎非常重要。该参数有 3 个值，分别为 0、1 和 2。该参数的默认值为1。<br><code>值为 0 时</code>，表示 <code>每秒1次</code> 的频率将数据写入日志文件并将日志文件写入磁盘。每个事务的 commit 并不会触发前面的任何操作。该模式速度最快，但不太安全，mysqld进程的崩溃会导致上一秒钟所有事务数据的丢失。<br><code>值为 1 时</code>，表示 <code>每次提交事务时</code> 将数据写入日志文件并将日志文件写入磁盘进行同步。该模式是最安全的，但也是最慢的一种方式。因为每次事务提交或事务外的指令都需要把日志写入（flush）硬盘。<br><code>值为 2 时</code>，表示 <code>每次提交事务时</code> 将数据写入日志文件，<code>每隔1秒</code> 将日志文件写入磁盘。该模式速度较快，也比0安全，只有在操作系统崩溃或者系统断电的情况下，上一秒钟所有事务数据才可能丢失。</p>
<p><code>innodb_log_buffer_size</code>：这是 InnoDB 存储引擎的 <code>事务日志所使用的缓冲区</code> 。为了提高性能，也是先将信息写入 Innodb Log Buffer 中，当满足 innodb_flush_log_trx_commit 参数所设置相应条件（或者日志缓冲区写满）之后，才会将日志写到文件（或者同步到磁盘）中。</p>
<p><code>max_connections</code>：表示 <code>允许连接到 MySQL 数据库的最大数量</code> ，默认值是 <code>151</code> 。如果状态变量 <code>connection_errors_max_connections</code> 不为零，并且一直增长，则说明不断有连接请求因数据库连接数已达到允许最大值而失败，这是可以考虑增大 <code>max_connections</code> 的值。在 Linux 平台下，性能好的服务器，支持 500-1000 个连接不是难事，需要根据服务器性能进行评估设定。这个连接数 不是越大越好 ，因为这些连接会浪费内存的资源。过多的连接可能会导致MySQL服务器僵死。</p>
<p><code>back_log</code>：用于 <code>控制 MySQL 监听 TCP 端口时设置的积压请求栈大小</code> 。如果MySql的连接数达到 max_connections 时，新来的请求将会被存在堆栈中，以等待某一连接释放资源，该堆栈的数量即 back_log，如果等待连接的数量超过 back_log ，将不被授予连接资源，将会报错。5.6.6 版本之前默认值为 50 ， 之后的版本默认为 50 + （max_connections / 5）， 对于Linux系统推荐设置为小于 512 的整数，但最大不超过900。如果需要数据库在较短的时间内处理大量连接请求， 可以考虑适当增大back_log 的值。</p>
<p><code>thread_cache_size</code>： <code>线程池缓存线程数量的大小</code> ，当客户端断开连接后将当前线程缓存起来，当在接到新的连接请求时快速响应无需创建新的线程 。这尤其对那些使用短连接的应用程序来说可以极大的提高创建连接的效率。那么为了提高性能可以增大该参数的值。默认为60，可以设置为120。可以通过如下几个MySQL状态值来适当调整线程池的大小：</p>
<figure class="highlight cmd"><table><tr><td class="code"><pre><span class="line">mysql&gt; show global status like &#x27;Thread%&#x27;;</span><br><span class="line">+-------------------+-------+</span><br><span class="line">| Variable_name | Value |</span><br><span class="line">+-------------------+-------+</span><br><span class="line">| Threads_cached | <span class="number">2</span> |</span><br><span class="line">| Threads_connected | <span class="number">1</span> |</span><br><span class="line">| Threads_created | <span class="number">3</span> |</span><br><span class="line">| Threads_running | <span class="number">2</span> |</span><br><span class="line">+-------------------+-------+</span><br><span class="line"><span class="number">4</span> rows <span class="keyword">in</span> <span class="built_in">set</span> (<span class="number">0</span>.<span class="number">01</span> sec)</span><br></pre></td></tr></table></figure>

<p>当 Threads_cached 越来越少，但 Threads_connected 始终不降，且 Threads_created 持续升高，可适当增加 thread_cache_size 的大小。</p>
<p><code>wait_timeout</code>：指定 <code>一个请求的最大连接时间</code> ，对于 4GB 左右内存的服务器可以设置为5-10。</p>
<p><code>interactive_timeout</code>：表示服务器在关闭连接前等待行动的秒数。</p>
<h2 id="其他优化"><a href="#其他优化" class="headerlink" title="其他优化"></a>其他优化</h2><p><strong>分析表：</strong></p>
<p>MySQL中提供了 ANALYZE TABLE 语句分析表 ANALYZE TABLE 语句的基本语法如下：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">ANALYZE [<span class="keyword">LOCAL</span> <span class="operator">|</span> NO_WRITE_TO_BINLOG] <span class="keyword">TABLE</span> tbl_name[,tbl_name]...</span><br></pre></td></tr></table></figure>

<p>默认的，MySQL 服务会将 ANALYZE TABLE 语句写到 binlog 中，以便在主从架构中，从服务能够同步数据。可以添加参数 LOCAL 或者 NO_WRITE_TO_BINLOG 取消将语句写到 binlog 中。</p>
<p>使用 ANALYZE TABLE 分析表的过程中，数据库系统会自动对表加一个 <code>只读锁</code> 。在分析期间，只能读取表中的记录，不能更新和插入记录。ANALYZE TABLE 语句能够分析 InnoDB 和 MyISAM 类型的表，但是不能作用于视图。</p>
<p>ANALYZE TABLE 分析后的统计结果会反应到 cardinality 的值，该值统计了表中某一键所在的列不重复的值的个数。该值越接近表中的总行数，则在表连接查询或者索引查询时，就越优先被优化器选择使用。也就是索引列的cardinality的值与表中数据的总条数差距越大，即使查询的时候使用了该索引作为查询条件，存储引擎实际查询的时候使用的概率就越小。下面通过例子来验证下。cardinality 可以通过 SHOW INDEX FROM 表名查看。</p>
<p><strong>检查表：</strong></p>
<p>MySQL 中可以使用 CHECK TABLE 语句来检查表。CHECK TABLE 语句能够检查 InnoDB 和 MyISAM 类型的表是否存在错误。CHECK TABLE 语句在执行过程中也会给表加上 <code>只读锁</code>。</p>
<p>对于 MyISAM 类型的表，CHECK TABLE 语句还会更新关键字统计数据。而且，CHECK TABLE 也可以检查视图是否有错误，比如在视图定义中被引用的表已不存在。该语句的基本语法如下：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CHECK</span> <span class="keyword">TABLE</span> tbl_name [, tbl_name] ... [option] ...</span><br><span class="line">option <span class="operator">=</span> &#123;QUICK <span class="operator">|</span> FAST <span class="operator">|</span> MEDIUM <span class="operator">|</span> EXTENDED <span class="operator">|</span> CHANGED&#125;</span><br></pre></td></tr></table></figure>

<p>其中，tbl_name 是表名；option 参数有5个取值，分别是</p>
<p>QUICK、FAST、MEDIUM、EXTENDED 和 CHANGED。</p>
<p>各个选项的意义分别是：</p>
<ul>
<li><code>QUICK</code> ：不扫描行，不检查错误的连接。</li>
<li><code>FAST</code> ：只检查没有被正确关闭的表。</li>
<li><code>CHANGED</code> ：只检查上次检查后被更改的表和没有被正确关闭的表。</li>
<li><code>MEDIUM</code> ：扫描行，以验证被删除的连接是有效的。也可以计算各行的关键字校验和，并使用计算出的校验和验证这一点。</li>
<li><code>EXTENDED</code> ：对每行的所有关键字进行一个全面的关键字查找。这可以确保表是 100% 一致的，但是花的时间较长。</li>
</ul>
<p>option 只对 MyISAM 类型的表有效，对 InnoDB 类型的表无效。比如：check table student</p>
<p>该语句对于检查的表可能会产生多行信息。最后一行有一个状态的 Msg_type 值，Msg_text 通常为 OK。<br>如果得到的不是 OK，通常要对其进行修复；是 OK 说明表已经是最新的了。表已经是最新的，意味着存储引擎对这张表不必进行检查。</p>
<p><strong>优化表：</strong></p>
<p>方式1：OPTIMIZE TABLE</p>
<p>MySQL 中使用 OPTIMIZE TABLE 语句来优化表。但是，OPTILMIZE TABLE <code>语句只能优化表中的VARCHAR</code> 、 <code>BLOB</code> 或 <code>TEXT</code> 类型的字段。一个表使用了这些字段的数据类型，若已经 <code>删除</code> 了表的一大部分数据，或者已经对含有可变长度行的表（含有VARCHAR、BLOB或TEXT列的表）进行了很多 <code>更新</code> ，则应使用 OPTIMIZE TABLE 来重新利用未使用的空间，并整理数据文件的 <code>碎片</code> 。</p>
<p>OPTIMIZE TABLE 语句对 InnoDB 和 MyISAM 类型的表都有效。该语句在执行过程中也会给表加上 <code>只读锁</code> 。</p>
<p>OPTILMIZE TABLE语句的基本语法如下：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">OPTIMIZE [<span class="keyword">LOCAL</span> <span class="operator">|</span> NO_WRITE_TO_BINLOG] <span class="keyword">TABLE</span> tbl_name [, tbl_name] ...</span><br></pre></td></tr></table></figure>

<p>LOCAL | NO_WRITE_TO_BINLOG 关键字的意义和分析表相同，都是指定不写入二进制日志。</p>
<p>在 MyISAM 中，是先分析这张表，然后会整理相关的 MySQL datafile，之后回收未使用的空间。</p>
<p>在 InnoDB 中，回收空间是简单通过 Alter table 进行整理空间。在优化期间，MySQL 会创建一个临时表，优化完成之后会删除原始表，然后会将临时表 rename 成为原始表。</p>
<blockquote>
<p>说明： 在多数的设置中，根本不需要运行 OPTIMIZE TABLE。即使对可变长度的行进行了大量的更<br>新，也不需要经常运行，每周一次 或 每月一次 即可，并且只需要对 特定的表 运行。</p>
</blockquote>
<p><strong>超时处理：</strong></p>
<p>在 MySQL 8.0 中可以设置 <code>服务器语句超时的限制</code> ，单位可以达到 <code>毫秒级别</code> 。当中断的执行语句超过设置的毫秒数后，服务器将终止查询影响不大的事务或连接，然后将错误报给客户端。</p>
<p>设置服务器语句超时的限制，可以通过设置系统变量 <code>MAX_EXECUTION_TIME</code> 来实现。默认情况下， MAX_EXECUTION_TIME 的值为 0，代表没有时间限制。 例如：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> MAX_EXECUTION_TIME<span class="operator">=</span><span class="number">2000</span>;</span><br><span class="line"><span class="keyword">SET</span> SESSION MAX_EXECUTION_TIME<span class="operator">=</span><span class="number">2000</span>; </span><br></pre></td></tr></table></figure>

<p><strong>创建全局通用表空间：</strong></p>
<h1 id="主键的设计"><a href="#主键的设计" class="headerlink" title="主键的设计"></a>主键的设计</h1><p>通常情况下，会直接使用自增 ID 作为主键。这样使用简单方便，但是缺点也很多。</p>
<ol>
<li><p>可靠性不高：存在自增 ID 回溯的问题。</p>
</li>
<li><p>安全性不高：对外暴露的接口可以非常容易猜测对应的信息。比如：<code>/User/1/</code> 这样的接口，可以非常容易猜测用户 ID 的值为多少，总用户数量有多少，也可以非常容易地通过接口进行数据的爬取。</p>
</li>
<li><p>占用性能：自增 ID 由 MySQL 服务端生成。</p>
</li>
<li><p>交互多：业务还需要额外执行一次类似 last_insert_id() 的函数才能知道刚才插入的自增值，这需要多一次的网络交互。在海量并发的系统中，多 1 条 SQL，就多一次性能上的开销。</p>
</li>
<li><p>局部唯一性：自增ID是局部唯一，只在当前数据库实例中唯一，而不是全局唯一：在任意服务器间都唯一。对于分布式系统十分不友好。</p>
</li>
</ol>
<p><strong>推荐的主键设计：</strong></p>
<p>非核心业务：对应表的主键自增 ID，如告警、日志、监控等信息。</p>
<p>核心业务：主键设计至少应该是全局唯一且是单调递增。全局唯一保证在各系统之间都是唯一的，单调<br>递增是希望插入时不影响数据库性能。</p>
<p>这里推荐最简单的一种主键设计：UUID。</p>
<p>UUID的特点：全局唯一，占用36字节，数据无序，插入性能差。</p>
<p>MySQL 数据库的 UUID 组成如下所示：</p>
<pre><code>UUID = 时间 + UUID版本（16字节）- 时钟序列（4字节） - MAC地址（12字节）
例如: 6e773a2d-07a6-11ee-8d6d-9a047a11b35d
</code></pre>
<p>UUID 的设计中，将时间低位放在最前面，这部分的数据是一直在变化的，并且是无序。</p>
<p>若将时间高低位互换，则时间就是单调递增的了，也就变得单调递增了。MySQL 8.0 可以更换时间低位和时间高位的存储方式，这样 UUID 就是有序的 UUID 了。</p>
<p>MySQL 8.0 还解决了 UUID 存在的空间占用的问题，除去了 UUID 字符串中无意义的 “-“ 字符串，并且将字符串用二进制类型保存，这样存储空间降低为了 16 字节。</p>
<p>可以通过 MySQL 8.0 提供的 <code>uuid_to_bin</code> 函数实现上述功能，同样的，MySQL 也提供了 <code>bin_to_uuid</code> 函数进行转化：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SET</span> <span class="variable">@uuid</span> <span class="operator">=</span> UUID();</span><br><span class="line"><span class="keyword">SELECT</span> <span class="variable">@uuid</span>,uuid_to_bin(<span class="variable">@uuid</span>),uuid_to_bin(<span class="variable">@uuid</span>,<span class="literal">TRUE</span>);</span><br></pre></td></tr></table></figure>

<p>在真实的业务系统中，主键还可以加入业务和系统属性，如用户的尾号，机房的信息等。</p>
<p><strong>其他办法：</strong></p>
<p>在设计各个分店的会员表的主键时，因为如果每台机器各自产生的数据需要合并，就可能会出现主键重复的问题。</p>
<p>可以在总部 MySQL 数据库中，创建一个管理信息表，在这个表中添加一个字段，专门用来记录当前会员编号的最大值。</p>
<p>门店在添加会员的时候，先到总部 MySQL 数据库中获取这个最大值，在这个基础上加 1，然后用这个值作为新会员的 ID，同时，更新总部 MySQL 数据库管理信息表中的当前会员编号的最大值。</p>
<p>这样一来，各个门店添加会员的时候，都对同一个总部 MySQL 数据库中的数据表字段进行操作，解决了各门店添加会员时会员编号冲突的问题</p>
<h1 id="数据库设计范式"><a href="#数据库设计范式" class="headerlink" title="数据库设计范式"></a>数据库设计范式</h1><blockquote>
<p>来自 ChatGPT</p>
</blockquote>
<p>数据库设计范式（Database Normalization）是一组规范化原则，用于设计关系型数据库的表结构，旨在提高数据库的数据完整性、减少冗余数据，并提高数据查询和维护的效率。</p>
<p>常见的数据库设计范式包括以下几个级别：</p>
<ol>
<li><p>第一范式（1NF）：要求数据库表中的每个列都是不可再分的，即每个列都应该包含一个单一的值。</p>
</li>
<li><p>第二范式（2NF）：要求满足1NF，并且非主键列完全依赖于主键，即不存在部分依赖。</p>
</li>
<li><p>第三范式（3NF）：要求满足2NF，并且非主键列之间不存在传递依赖关系，即不存在非主键列依赖于其他非主键列。</p>
</li>
</ol>
<p>通常情况下，第三范式已经可以满足大多数数据库设计需求。然而，有些情况下为了进一步优化性能或满足特定需求，可以考虑其他范式，如 BCNF（Boyce-Codd范式）和第四范式（4NF）等。</p>
<p>数据库设计范式的目标是通过合理的表结构设计，减少数据冗余和更新异常，提高数据一致性和查询效率。然而，在实际的数据库设计中，范式并不是唯一的目标，还需要考虑具体的应用需求和性能优化的考虑。有时候，根据具体情况可能会违反一些范式原则，以满足特定的业务需求。因此，在设计数据库时，需要综合考虑范式和具体业务需求之间的权衡。</p>
<h1 id="数据库对象编写建议"><a href="#数据库对象编写建议" class="headerlink" title="数据库对象编写建议"></a>数据库对象编写建议</h1><h2 id="数据库"><a href="#数据库" class="headerlink" title="数据库"></a>数据库</h2><ol>
<li>【强制】库的名称必须控制在32个字符以内，只能使用英文字母、数字和下划线，建议以英文字母开头。</li>
<li>【强制】库名中英文一律小写 ，不同单词采用 <code>下划线</code> 分割。须见名知意。</li>
<li>【强制】库的名称格式：业务系统名称_子系统名。</li>
<li>【强制】库名禁止使用关键字（如type,order等）。</li>
<li>【强制】创建数据库时必须 <code>显式指定字符集</code> ，并且字符集只能是 utf8 或者 utf8mb4。创建数据库SQL举例：CREATE DATABASE crm_fund DEFAULT CHARACTER SET ‘utf8’ ;</li>
<li>【建议】对于程序连接数据库账号，遵循 <code>权限最小原则</code>， 使用数据库账号只能在一个 DB 下使用，不准跨库。程序使用的账号 <code>原则上不准有 drop 权限</code> 。</li>
<li>【建议】临时库以 <code>tmp_</code> 为前缀，并以日期为后缀；备份库以 <code>bak_</code> 为前缀，并以日期为后缀。</li>
</ol>
<h2 id="数据表、列"><a href="#数据表、列" class="headerlink" title="数据表、列"></a>数据表、列</h2><ol>
<li>【强制】表和列的名称必须控制在 32 个字符以内，表名只能使用英文字母、数字和下划线，建议以 <code>英文字母开头</code> 。</li>
<li>【强制】表名、列名一律小写，不同单词采用下划线分割。须见名知意。</li>
<li>【强制】表名要求有模块名强相关，同一模块的表名尽量使用 <code>统一前缀</code> 。比如：crm_fund_item</li>
<li>【强制】创建表时必须 显式指定字符集为 utf8 或 utf8mb4。</li>
<li>【强制】表名、列名禁止使用关键字（如type,order等）。</li>
<li>【强制】创建表时必须 显式指定表存储引擎 类型。如无特殊需求，一律为 InnoDB。</li>
<li>【强制】建表必须有 comment。</li>
<li>【强制】字段命名应尽可能使用表达实际含义的英文单词或 缩写 。如：公司 ID，不要使用corporation_id, 而用 corp_id 即可。</li>
<li>【强制】布尔值类型的字段命名为 is_描述 。如 member 表上表示是否为 enabled 的会员的字段命名为 <code>is_enabled</code>（争议）。</li>
<li>【强制】禁止在数据库中存储图片、文件等大的二进制数据通常文件很大，短时间内造成数据量快速增长，数据库进行数据库读取时，通常会进行大量的随机IO操作，文件很大时，IO操作很耗时。通常存储于文件服务器，数据库只存储文件地址信息。</li>
<li>【建议】建表时关于主键： 表必须有主键。</li>
</ol>
<ul>
<li>强制要求主键为 id，类型为 int 或 bigint，且为 auto_increment 建议使用 unsigned 无符号型。</li>
<li>标识表里每一行主体的字段不要设为主键，建议设为其他字段如 user_id、order_id 等，并建立 unique key 索引。因为如果设为主键且主键值为随机插入，则会导致 InnoDB 内部页分裂和大量随机I/O，性能下降。</li>
</ul>
<ol start="12">
<li>【建议】核心表（如用户表）必须有行数据的 <code>创建时间字段</code> （create_time）和 <code>最后更新时间</code> 字段（update_time），便于查问题。</li>
<li>【建议】表中所有字段尽量都是 <code>NOT NULL</code> 属性，业务可以根据需要定义 <code>DEFAULT</code> 值 。 因为用 <code>NULL</code> 值会存在每一行都会占用额外存储空间、数据迁移容易出错、聚合函数计算结果偏差等问题。</li>
<li>【建议】所有存储相同数据的 <code>列名和列类型必须一致</code> （一般作为关联列，如果查询时关联列类型不一致会自动进行数据类型隐式转换，会造成列上的索引失效，导致查询效率降低）。</li>
<li>【建议】中间表（或临时表）用于保留中间结果集，名称以 <code>tmp_</code> 开头。备份表用于备份或抓取源表快照，名称以 <code>bak_</code> 开头。中间表和备份表定期清理。</li>
</ol>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://javac.me">向日葵</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://javac.me/article/27/">https://javac.me/article/27/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://javac.me" target="_blank">向日葵</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="/images/global/gravatar.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn1.tianli0.top/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn1.tianli0.top/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/article/28/" title="尚硅谷笔记 - MyBatis"><div class="cover" style="background: url(/images/posts/cover/mybatis-basic.png)"></div><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">尚硅谷笔记 - MyBatis</div></div></a></div><div class="next-post pull-right"><a href="/article/22/" title="Windows 清理桌面图标"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Windows 清理桌面图标</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/images/global/gravatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">向日葵</div><div class="author-info__description">Java 学习中...</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">26</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">29</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">3</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/shironekoa3"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/shironekoa3" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="https://twitter.com/shironekoa3" target="_blank" title="Email"><i class="fab fa-twitter" style="color: #4a7dbe;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#MySQL-%E5%9F%BA%E7%A1%80"><span class="toc-text">MySQL 基础</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95-DML"><span class="toc-text">基础语法(DML)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E6%93%8D%E4%BD%9C-DDL"><span class="toc-text">数据库操作(DDL)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E8%A1%A8%E6%93%8D%E4%BD%9C"><span class="toc-text">数据表操作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BA%A6%E6%9D%9F-amp-%E8%A7%86%E5%9B%BE"><span class="toc-text">约束 &amp; 视图</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E4%B8%8E%E5%87%BD%E6%95%B0"><span class="toc-text">存储过程与函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#PROCEDURE"><span class="toc-text">PROCEDURE</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#FUNCTION"><span class="toc-text">FUNCTION</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E8%AF%B4%E6%98%8E"><span class="toc-text">数据类型说明</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#MySQL-%E5%AE%89%E8%A3%85"><span class="toc-text">MySQL 安装</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Windows"><span class="toc-text">Windows</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Linux"><span class="toc-text">Linux</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#MySQL-%E8%BF%9C%E7%A8%8B%E8%BF%9E%E6%8E%A5"><span class="toc-text">MySQL 远程连接</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#MySQL-%E5%AF%86%E7%A0%81%E5%BC%BA%E5%BC%B1%E8%AF%84%E4%BC%B0"><span class="toc-text">MySQL 密码强弱评估</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%80%E5%90%AF%E6%8F%92%E4%BB%B6"><span class="toc-text">开启插件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E6%A3%80%E6%B5%8B%E6%96%B9%E5%BC%8F"><span class="toc-text">修改检测方式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%B8%E8%BD%BD%E6%8F%92%E4%BB%B6"><span class="toc-text">卸载插件</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#MySQL-%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84"><span class="toc-text">MySQL 目录结构</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E4%B8%8E%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86"><span class="toc-text">用户与权限管理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86"><span class="toc-text">用户管理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E5%AF%86%E7%A0%81%E8%BF%87%E6%9C%9F%E7%AD%96%E7%95%A5"><span class="toc-text">用户密码过期策略</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E5%AF%86%E7%A0%81%E9%87%8D%E7%94%A8%E7%AD%96%E7%95%A5"><span class="toc-text">用户密码重用策略</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86"><span class="toc-text">权限管理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%83%E9%99%90%E8%A1%A8"><span class="toc-text">权限表</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%92%E8%89%B2%E7%AE%A1%E7%90%86-MySQL-8-0"><span class="toc-text">角色管理(MySQL 8.0)</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E"><span class="toc-text">存储引擎</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#InnoDB-%E4%B8%8E-MyISAM"><span class="toc-text">InnoDB 与 MyISAM</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E"><span class="toc-text">其他存储引擎</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1"><span class="toc-text">事务</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1-ACID"><span class="toc-text">事务 ACID</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E5%BC%80%E5%90%AF"><span class="toc-text">事务开启</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9A%90%E5%BC%8F%E4%BA%8B%E5%8A%A1"><span class="toc-text">隐式事务</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB"><span class="toc-text">隔离级别</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90"><span class="toc-text">性能分析</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E7%B3%BB%E7%BB%9F%E5%8F%82%E6%95%B0"><span class="toc-text">查看系统参数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#mysqldumpslow"><span class="toc-text">mysqldumpslow</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SHOW-PROFILING"><span class="toc-text">SHOW PROFILING</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#EXPLAIN-amp-DESCRIBE"><span class="toc-text">EXPLAIN &amp; DESCRIBE</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95-amp-%E4%BC%98%E5%8C%96"><span class="toc-text">索引 &amp; 优化</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E5%88%9B%E5%BB%BA%E4%B8%8E%E5%88%A0%E9%99%A4"><span class="toc-text">索引创建与删除</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%82%E5%90%88%E5%88%9B%E5%BB%BA%E7%B4%A2%E5%BC%95%E7%9A%84%E6%83%85%E5%86%B5"><span class="toc-text">适合创建索引的情况</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%8D%E9%80%82%E5%90%88%E5%88%9B%E5%BB%BA%E7%B4%A2%E5%BC%95%E7%9A%84%E6%83%85%E5%86%B5"><span class="toc-text">不适合创建索引的情况</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88%E7%9A%84%E6%83%85%E5%86%B5"><span class="toc-text">索引失效的情况</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96"><span class="toc-text">查询优化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%89%8D%E7%BC%80%E7%B4%A2%E5%BC%95"><span class="toc-text">字符串前缀索引</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A6%86%E7%9B%96%E7%B4%A2%E5%BC%95"><span class="toc-text">覆盖索引</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E4%B8%8B%E6%8E%A8"><span class="toc-text">索引下推</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E4%BC%98%E5%8C%96%E7%AD%96%E7%95%A5"><span class="toc-text">其他优化策略</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E8%B0%83%E4%BC%98"><span class="toc-text">数据库调优</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%89%E6%8B%A9-DBMS"><span class="toc-text">选择 DBMS</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BC%98%E5%8C%96%E8%A1%A8%E8%AE%BE%E8%AE%A1"><span class="toc-text">优化表设计</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BC%98%E5%8C%96%E9%80%BB%E8%BE%91%E6%9F%A5%E8%AF%A2"><span class="toc-text">优化逻辑查询</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BC%98%E5%8C%96%E7%89%A9%E7%90%86%E6%9F%A5%E8%AF%A2"><span class="toc-text">优化物理查询</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%86%85%E5%AD%98%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-text">使用内存数据库</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BA%93%E7%BA%A7%E4%BC%98%E5%8C%96"><span class="toc-text">库级优化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%A7%E8%A1%A8%E4%BC%98%E5%8C%96"><span class="toc-text">大表优化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BC%98%E5%8C%96%E5%8F%82%E6%95%B0%E9%85%8D%E7%BD%AE"><span class="toc-text">优化参数配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E4%BC%98%E5%8C%96"><span class="toc-text">其他优化</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%BB%E9%94%AE%E7%9A%84%E8%AE%BE%E8%AE%A1"><span class="toc-text">主键的设计</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1%E8%8C%83%E5%BC%8F"><span class="toc-text">数据库设计范式</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AF%B9%E8%B1%A1%E7%BC%96%E5%86%99%E5%BB%BA%E8%AE%AE"><span class="toc-text">数据库对象编写建议</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-text">数据库</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E8%A1%A8%E3%80%81%E5%88%97"><span class="toc-text">数据表、列</span></a></li></ol></li></ol></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2018 - 2023 By 向日葵</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn1.tianli0.top/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn1.tianli0.top/npm/node-snackbar/dist/snackbar.min.js"></script><div class="js-pjax"></div><script defer="defer" id="ribbon" src="https://cdn1.tianli0.top/npm/butterfly-extsrc/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="false"></script><script src="https://cdn1.tianli0.top/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script></div></body></html>